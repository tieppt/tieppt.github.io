<!DOCTYPE html>
<html class="no-js">
  <head>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--<title>Rxjs Và Reactive Programming</title>-->
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Rxjs Và Reactive Programming | Lập Trình Thật Kỳ Diệu</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Rxjs Và Reactive Programming" />
<meta name="author" content="Tiep Phan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Giới thiệu Rxjs và Reactive Programming và ứng dụng trong Angular" />
<meta property="og:description" content="Giới thiệu Rxjs và Reactive Programming và ứng dụng trong Angular" />
<link rel="canonical" href="https://www.tiepphan.com/rxjs-reactive-programming/" />
<meta property="og:url" content="https://www.tiepphan.com/rxjs-reactive-programming/" />
<meta property="og:site_name" content="Lập Trình Thật Kỳ Diệu" />
<meta property="og:image" content="https://www.tiepphan.com/assets/uploads/2017/09/rxjs-reactive-programming.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-16T10:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://www.tiepphan.com/assets/uploads/2017/09/rxjs-reactive-programming.jpg" />
<meta property="twitter:title" content="Rxjs Và Reactive Programming" />
<meta name="google-site-verification" content="Gcn3Y0oBud7gufI1PtszF7DFNgFOifgLRIaZAoLZWWU" />
<meta name="msvalidate.01" content="F160AE523B1846CBDC431CB91CB6613A" />
<script type="application/ld+json">
{"description":"Giới thiệu Rxjs và Reactive Programming và ứng dụng trong Angular","url":"https://www.tiepphan.com/rxjs-reactive-programming/","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.tiepphan.com/assets/logo.png"},"name":"Tiep Phan"},"image":"https://www.tiepphan.com/assets/uploads/2017/09/rxjs-reactive-programming.jpg","headline":"Rxjs Và Reactive Programming","dateModified":"2017-09-16T10:00:00+00:00","datePublished":"2017-09-16T10:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.tiepphan.com/rxjs-reactive-programming/"},"author":{"@type":"Person","name":"Tiep Phan"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>

<!-- CSS -->
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600|Roboto:100,300,400,500,700|Volkhov:400i">
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />

<!--
/*
 * Airspace
 * Ported to Jekyll by Andrew Lee
 * https://github.com/luminousrubyist/airspace-jekyll
 * Designed and Developed by ThemeFisher
 * https://themefisher.com/
 *
 */
-->


  </head>
  <body>


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <!-- header Nav Start -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tiepphan.com">
              <img src="/assets/logo.png" alt="Logo" class="img-logo">
              <span>Lập trình thật kỳ diệu</span>
            </a>
          </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/work/">Work</a></li>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/about/">About</a></li>
                <li><a href="/contact/">Contact</a></li>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
    </div>
  </div>
</header><!-- header close -->



    <div class="post">
  <!-- Wrapper Start -->
  <section>
    <div class="container">
      <div class="row">
        <div class="col-md-9">
          <div class="block">
            <h1>Rxjs Và Reactive Programming</h1>
            <div class="post-info-wrapper">
              <p class="italic">By <span class="bold">Tiep Phan</span> on <span class="bold">September 16, 2017</span></p>
            </div>
            <hr />
            <p><h1 class="no_toc" id="rxjs-và-reactive-programming">Rxjs Và Reactive Programming</h1>

<p>Hẳn các bạn vẫn còn nhớ trong một số bài trước chúng ta có nói về <strong>Observable</strong> trong ứng dụng Angular, vậy <strong>Observable</strong> là gì, nó có quan hệ gì với Angular, làm thế nào để sử dụng <strong>Observable</strong> hiệu quả trong ứng dụng của bạn. Trong bài này chúng ta sẽ cùng tìm hiểu về <strong>Observable</strong>, về <strong>Rxjs</strong>, <strong>Reactive Programming</strong>.</p>

<ul class="tp__toc" id="markdown-toc">
  <li><a href="#post-intro" id="markdown-toc-post-intro">1. Giới thiệu</a></li>
  <li><a href="#array" id="markdown-toc-array">2. Array Trong Javascript</a>    <ul>
      <li><a href="#array-foreach" id="markdown-toc-array-foreach">2.1 Array forEach</a></li>
      <li><a href="#array-map" id="markdown-toc-array-map">2.2 Array map</a></li>
      <li><a href="#array-filter" id="markdown-toc-array-filter">2.3 Array filter</a></li>
      <li><a href="#array-reduce" id="markdown-toc-array-reduce">2.4 Array reduce</a></li>
      <li><a href="#flatten-array" id="markdown-toc-flatten-array">2.5 Flatten Array</a></li>
    </ul>
  </li>
  <li><a href="#producer-consumer-push-pull" id="markdown-toc-producer-consumer-push-pull">3. Producer vs Consumer, Push vs Pull</a></li>
  <li><a href="#observable" id="markdown-toc-observable">4. Observable</a></li>
  <li><a href="#anatomy-observable" id="markdown-toc-anatomy-observable">5. Làm Quen Với Observable</a>    <ul>
      <li><a href="#creating-observables" id="markdown-toc-creating-observables">5.1 Creating Observables</a></li>
      <li><a href="#subscribing-observables" id="markdown-toc-subscribing-observables">5.2 Subscribing to Observables</a></li>
      <li><a href="#executing-observables" id="markdown-toc-executing-observables">5.3 Executing Observables</a></li>
      <li><a href="#disposing-observables" id="markdown-toc-disposing-observables">5.4 Disposing Observable Executions</a></li>
    </ul>
  </li>
  <li><a href="#rxjs-observer" id="markdown-toc-rxjs-observer">6. Observer</a></li>
  <li><a href="#rxjs-subscription" id="markdown-toc-rxjs-subscription">7. Subscription</a></li>
  <li><a href="#rxjs-cold-hot-observables" id="markdown-toc-rxjs-cold-hot-observables">8. Cold Observables vs Hot Observables</a></li>
  <li><a href="#rxjs-subject" id="markdown-toc-rxjs-subject">9. Subject</a>    <ul>
      <li><a href="#rxjs-BehaviorSubject" id="markdown-toc-rxjs-BehaviorSubject">9.1 BehaviorSubject</a></li>
      <li><a href="#rxjs-ReplaySubject" id="markdown-toc-rxjs-ReplaySubject">9.2 ReplaySubject</a></li>
      <li><a href="#rxjs-AsyncSubject" id="markdown-toc-rxjs-AsyncSubject">9.3 AsyncSubject</a></li>
      <li><a href="#rxjs-SubjectComplete" id="markdown-toc-rxjs-SubjectComplete">9.4 Subject Complete</a></li>
    </ul>
  </li>
  <li><a href="#rxjs-Operators" id="markdown-toc-rxjs-Operators">10. Operators</a>    <ul>
      <li><a href="#InstancevsStaticOperators" id="markdown-toc-InstancevsStaticOperators">10.1 Instance operators vs static operators</a></li>
      <li><a href="#rxjs-CreationOperators" id="markdown-toc-rxjs-CreationOperators">10.2 Creation Operators</a></li>
      <li><a href="#rxjs-TransformationOperators" id="markdown-toc-rxjs-TransformationOperators">10.3 Transformation Operators</a></li>
      <li><a href="#rxjs-FilteringOperators" id="markdown-toc-rxjs-FilteringOperators">10.4 Filtering Operators</a></li>
      <li><a href="#rxjs-CombinationOperators" id="markdown-toc-rxjs-CombinationOperators">10.5 Combination Operators</a></li>
      <li><a href="#rxjs-ErrorHandlingOperators" id="markdown-toc-rxjs-ErrorHandlingOperators">10.5 Error Handling Operators</a></li>
      <li><a href="#rxjs-UtilityOperators" id="markdown-toc-rxjs-UtilityOperators">10.6 Utility Observables</a></li>
      <li><a href="#rxjs-HigherOrderOperators" id="markdown-toc-rxjs-HigherOrderOperators">10.7 Higher Order Observables</a></li>
    </ul>
  </li>
  <li><a href="#rxjs-summary" id="markdown-toc-rxjs-summary">11. Tổng kết</a></li>
  <li><a href="#rxjs-references" id="markdown-toc-rxjs-references">12. Link tham khảo</a></li>
</ul>

<h2 id="post-intro">1. Giới thiệu</h2>

<p>Angular đi kèm với một dependency là Rxjs giúp cho nó trở nên <strong>reactive</strong>, một ứng dụng Angular là một <strong>reactive system</strong>.
Dễ thấy nhất ở đây chính là EventEmitter, hay Reactive Forms mà chúng ta đã tìm hiểu trong các bài học trước.</p>

<p>Vậy <strong>Reactive Programming</strong> (RP) là gì? Điều gì khiến nó trở thành một chủ đề hot như vậy…</p>

<p>Hiện tại, có cả tá định nghĩa về RP, nhưng mình thấy định nghĩa sau đây là bao quát tốt vấn đề:</p>

<p><strong>Reactive programming is programming with asynchronous data streams</strong></p>

<p>Vâng đúng vậy, đây là phương pháp lập trình xoay quanh <strong>data streams</strong> và nó deal với các vấn đề của <strong>asynchronous</strong>. Nhưng bạn đừng hiểu lầm, nó có thể deal với cả <strong>synchronous</strong> nữa.</p>

<p>Bạn có thể tưởng tượng data streams như hình sau, với <code class="language-plaintext highlighter-rouge">data</code> được gửi đến trong suốt dòng thời gian của một stream (over time), giống như một array có các phần tử được gửi đến lần lượt theo thời gian.</p>

<p class="text-center"><img src="/assets/uploads/2017/09/packages.gif" alt="data streams" class="img-responsive" /></p>

<p>Và chúng ta có thể coi mọi thứ là stream: single value, array, event, etc.</p>

<p class="text-center"><img src="/assets/uploads/2017/09/everything-is-a-stream.jpg" alt="everything-is-a-stream" class="img-responsive" /></p>

<p>Không những thế, khi thao tác với stream, chúng ta có thể có <code class="language-plaintext highlighter-rouge">value</code>, <code class="language-plaintext highlighter-rouge">error</code>, hay <code class="language-plaintext highlighter-rouge">complete</code> signals. Đây là điều mà các API trước đây của các hệ thống event trong Javascript còn thiếu, chúng có qua nhiều interface khác nhau cho các loại event khác nhau, Observable sinh ra để tổng quát hóa các interface đó lại.</p>

<p class="text-center"><img src="/assets/uploads/2017/09/figure-stream.png" alt="figure-stream" class="img-responsive" /></p>

<p>Và Rxjs giúp chúng ta có được <strong>reactive</strong> trong lập trình ứng dụng Javascript:</p>

<blockquote>
  <p>Rxjs is a library for composing asynchronous and event-based programs by using observable sequences.</p>

  <p>Think of Rxjs as Lodash (ultility for array/object) for events/streams.</p>

  <p>ReactiveX combines the Observer pattern with the Iterator pattern and functional programming with collections to fill the need for an ideal way of managing sequences of events.</p>

</blockquote>

<p><strong>Các Concepts nền tảng của Rxjs bao gồm:</strong></p>

<blockquote>
  <p>An Observable is a collection that arrives over time</p>
</blockquote>

<ul class="tpc__list">
  <li><strong>Observable</strong>: đại diện cho khái niệm về một tập hợp các giá trị hoặc các sự kiện trong tương lai. Khi các giá trị hoặc sự kiện phát sinh trong tương lai, Observable sẽ điều phối nó đến Observer.</li>
  <li><strong>Observer</strong>: là một tập hợp các callbacks tương ứng cho việc lắng nghe các giá trị (<code class="language-plaintext highlighter-rouge">next</code>, <code class="language-plaintext highlighter-rouge">error</code>, hay <code class="language-plaintext highlighter-rouge">complete</code>) được gửi đến bởi Observable.</li>
  <li><strong>Subscription</strong>: là kết quả có được sau khi thực hiện một Observable, nó thường dùng cho việc hủy việc tiếp tục xử lý.</li>
  <li><strong>Operators</strong>: là các pure functions cho phép lập trình functional với Observable.</li>
  <li><strong>Subject</strong>: để thực hiện việc gửi dữ liệu đến nhiều Observers (multicasting).</li>
  <li><strong>Schedulers</strong>: một scheduler sẽ điều khiển khi nào một subscription bắt đầu thực thi, và khi nào sẽ gửi tín hiệu đi. (Trong bài này chúng ta sẽ không nói về phần này).</li>
</ul>

<h2 id="array">2. Array Trong Javascript</h2>

<p>Trước khi bắt đầu với Observable, chúng ta sẽ ôn lại một số kiến thức về Array sẽ giúp ích trong việc tiếp cận Observable.</p>

<h3 id="array-foreach">2.1 Array forEach</h3>

<p>Array <code class="language-plaintext highlighter-rouge">forEach</code> là một trong các cách để ta có thể lặp qua lần lượt từng phần tử trong mảng.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> =&gt; </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">item</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<p>Kết quả nhận được của chúng ta như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">0 =&gt; 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">1 =&gt; 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">2 =&gt; 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">3 =&gt; 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">4 =&gt; 5</span><span class="dl">"</span>
</code></pre></div></div>

<p>Ngoại trừ một điểm chúng ta cần lưu ý khi các phần tử là kiểu reference thay vì kiểu primitive, thì <code class="language-plaintext highlighter-rouge">forEach</code> có thể khiến các phần tử của array ban đầu thay đổi giá trị.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ref</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">2</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">3</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">4</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="na">value</span><span class="p">:</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="p">];</span>

<span class="nx">ref</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="o">++</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">ref</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">index</span> <span class="o">+</span> <span class="dl">'</span><span class="s1"> =&gt; </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="array-map">2.2 Array map</h3>

<p>Array <code class="language-plaintext highlighter-rouge">map</code> cho phép chúng ta lặp qua tất cả các phần tử trong mảng, áp dụng một function nào đó lên các phần tử để biến đổi, sau đó trả về một mảng các giá trị sau khi thực hiện function.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">amp</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">item</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">+</span> <span class="nx">index</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">amp</span><span class="p">);</span>

<span class="c1">// result</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="array-filter">2.3 Array filter</h3>

<p>Array <code class="language-plaintext highlighter-rouge">filter</code> cho phép chúng ta lặp qua tất cả các phần tử trong mảng, áp dụng một function nào đó lên các phần tử để kiểm tra, sau đó trả về một mảng các giá trị sau khi thực hiện hàm kiểm tra mà thỏa mãn điều kiện (<code class="language-plaintext highlighter-rouge">return true</code>) và giữ nguyên mảng cũ không bị ảnh hưởng.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">amp</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">item</span> <span class="o">+</span> <span class="nx">index</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">amp</span><span class="p">);</span>

<span class="c1">// result</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="array-reduce">2.4 Array reduce</h3>

<p>Method <code class="language-plaintext highlighter-rouge">reduce</code> cho phép chúng ta lặp qua tất cả các phần tử và áp dụng một function nào đó vào mỗi phần tử, function này có các tham số:</p>

<ul class="tpc__list">
  <li><code class="language-plaintext highlighter-rouge">accumulator</code>: giá trị trả về từ các lần call callback trước.</li>
  <li><code class="language-plaintext highlighter-rouge">currentValue</code>: giá trị của phần tử hiện tại trong array.</li>
  <li><code class="language-plaintext highlighter-rouge">currentIndex</code>: index của phần tử hiện tại.</li>
  <li><code class="language-plaintext highlighter-rouge">array</code>: chính là mảng hiện tại.</li>
</ul>

<p>Ngoài ra, chúng ta còn có thể cung cấp giá trị ban đầu <code class="language-plaintext highlighter-rouge">initialValue</code> sau tham số function đầu tiên.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">acc</span> <span class="o">*</span> <span class="nx">current</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="mi">120</span>

</code></pre></div></div>

<h3 id="flatten-array">2.5 Flatten Array</h3>

<p>Trong nhiều tình huống, chúng ta có các array, bên trong mỗi phần tử có thể là các array khác, lúc này chúng ta có nhiệm vụ làm giảm số chiều (flatten) đi chẳng hạn, chúng ta có thể có đoạn code xử lý sau trong Javascript.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">concatAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">.</span><span class="nx">apply</span><span class="p">([],</span> <span class="k">this</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]];</span>

<span class="kd">const</span> <span class="nx">flatten</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">concatAll</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">flatten</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

</code></pre></div></div>

<p>Như ở ví dụ trên, chúng ta flat mảng con 2 chiều thành 1 chiều, và chúng ta có thể flat nhiều lần để mỗi lần sẽ giảm đi 1 chiều.</p>

<p>Điều này các bạn sẽ hay gặp khi làm việc với Observable trả về Observable trong các phần tiếp theo.</p>

<h2 id="producer-consumer-push-pull">3. Producer vs Consumer, Push vs Pull</h2>

<blockquote>
  <p>Pull and Push are two different protocols how a data Producer can communicate with a data Consumer.</p>

</blockquote>

<p>OK, chúng ta lại có một số khái niệm mới:</p>

<p><strong>Producer</strong>: là nguồn sản sinh ra data.</p>

<p><strong>Consumer</strong>: là nơi <code class="language-plaintext highlighter-rouge">chế biến</code> data sản sinh từ Producer.</p>

<p><strong>Pull systems</strong>: Consumer sẽ quyết định khi nào lấy data từ Producer. Producer không quan tâm khi nào data sẽ được gửi đến cho Consumer.</p>

<p>Các <code class="language-plaintext highlighter-rouge">function</code> trong Javascript là một Pull system. Khi nào lời gọi hàm thì khi đó mới xử lý. Gọi <code class="language-plaintext highlighter-rouge">n</code> lần thì xử lý <code class="language-plaintext highlighter-rouge">n</code> lần.</p>

<p>Lưu ý: function chỉ trả về 1 giá trị sau khi lời gọi hàm được thực hiện. (một mảng cũng chỉ coi là 1 giá trị, vì nó được trả về 1 lần).</p>

<p><strong>Push systems</strong>: Producer sẽ quyết định khi nào gửi dữ liệu cho Consumer. Consumer không quan tâm khi nào nhận được data.</p>

<p>Promise, DOM events là các Push systems. Chúng ta register các callbacks và khi event phát sinh, các callbacks sẽ được gọi với dữ liệu từ Producer truyền vào.</p>

<p>Chúng ta có một bảng so sánh như sau:</p>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th> </th>
      <th><strong>Producer</strong></th>
      <th><strong>Consumer</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Pull</strong></td>
      <td><strong>Passive</strong>: produces data when requested.</td>
      <td><strong>Active</strong>: decides when data is requested.</td>
    </tr>
    <tr>
      <td><strong>Push</strong></td>
      <td><strong>Active</strong>: produces data at its own pace.</td>
      <td><strong>Passive</strong>: reacts to received data.</td>
    </tr>
  </tbody>
</table>

<p>Ví dụ:</p>

<p><strong>Pull</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">iter</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span>

<span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="na">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">}</span>

<span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="na">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">}</span>

<span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="na">value</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">}</span>

<span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="na">value</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">}</span>

<span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>

<span class="o">&gt;</span> <span class="p">{</span><span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span> <span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span>

</code></pre></div></div>

<p><strong>Push</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Clicked!</span><span class="dl">'</span><span class="p">));</span>

</code></pre></div></div>

<h2 id="observable">4. Observable</h2>

<p><strong>Lưu ý, để code theo các ví dụ trong bài học này, bạn có thể clone bin sau</strong>:</p>

<p><a href="https://jsbin.com/zazacew/1/edit?js,console" target="_blank">Rxjs starter - jsbin</a></p>

<p>Vậy Observable là gì?</p>

<p><strong>Observable</strong> chỉ là một function (class) mà nó có một số yêu cầu đặc biệt. Nó nhận đầu vào là một Function, mà Function này nhận đầu vào là một Observer và trả về một function để có thể thực hiện việc cancel quá trình xử lý. Thông thường (Rxjs 5) chúng ta đặt tên function đó là <code class="language-plaintext highlighter-rouge">unsubscribe</code>.</p>

<p><strong>Observer</strong>: một object có chứa các phương thức <code class="language-plaintext highlighter-rouge">next</code>, <code class="language-plaintext highlighter-rouge">error</code> và <code class="language-plaintext highlighter-rouge">complete</code> để xử lý dữ liệu tương ứng với các <code class="language-plaintext highlighter-rouge">signals</code> được gửi từ Observable.</p>

<blockquote>
  <p>Observables are functions that tie an observer to a producer. That’s it. They don’t necessarily set up the producer, they just set up an observer to listen to the producer, and generally return a teardown mechanism to remove that listener. The act of subscription is the act of “calling” the observable like a function, and passing it an observer.</p>

</blockquote>

<p>Nói theo cách lý thuyết hơn:</p>

<blockquote>
  <p>Observables are lazy Push collections of multiple values.</p>
</blockquote>

<p>Như vậy, chúng ta có thể thấy Observable là lazy computation, giống như function, nếu chúng ta tạo chúng ra mà không gọi, thì không có gì thực thi cả.</p>

<p>Tạm thời bỏ qua các chi tiết về hàm <code class="language-plaintext highlighter-rouge">create</code> dưới đây, chúng ta sẽ gặp lại nó khi tìm hiểu về <strong>Operator</strong>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getDetail</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">tiepphan.com</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Rxjs và Reactive Programming</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>

<p>Đến đây, nếu chúng ta không gọi hàm <code class="language-plaintext highlighter-rouge">getDetail</code>, hoặc không <code class="language-plaintext highlighter-rouge">invoke</code> đến <code class="language-plaintext highlighter-rouge">observable</code> thì chẳng có gì xảy ra cả.</p>

<p>Để thực thi, chúng ta sẽ làm như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">getDetail</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>

<span class="c1">// and</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">before subscribe</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">val</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">),</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">after subscribe</span><span class="dl">'</span><span class="p">);</span>

</code></pre></div></div>

<p>Và sau đây là kết quả chúng ta nhận được:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">tiepphan.com</span><span class="dl">"</span>
<span class="mi">100</span>
<span class="dl">"</span><span class="s2">before subscribe</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">Rxjs và Reactive Programming</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">after subscribe</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">done</span><span class="dl">"</span>

</code></pre></div></div>

<p>Observable có thể deal với cả sync và async.</p>

<blockquote>
  <p>Observables are able to deliver values either synchronously or asynchronously.</p>

</blockquote>

<h2 id="anatomy-observable">5. Làm Quen Với Observable</h2>

<p>Với Observable chúng ta sẽ quan tâm đến các thao tác như sau:</p>

<ul class="tpc__list">
  <li><strong>Creating</strong> Observables</li>
  <li><strong>Subscribing</strong> to Observables</li>
  <li><strong>Executing</strong> the Observable</li>
  <li><strong>Disposing</strong> Observables</li>
</ul>

<h3 id="creating-observables">5.1 Creating Observables</h3>

<p><code class="language-plaintext highlighter-rouge">Rx.Observable.create</code> là một operator, nó chỉ là một alias cho <code class="language-plaintext highlighter-rouge">Observable</code> constructor, chúng ta hoàn toàn có thể thay thế tương ứng bằng cách gọi constructor cũng cho kết quả tương tự.</p>

<p>Đầu vào của <code class="language-plaintext highlighter-rouge">constructor</code> yêu cầu một hàm gọi là <code class="language-plaintext highlighter-rouge">subscribe</code> mà hàm này có đầu vào là một <code class="language-plaintext highlighter-rouge">observer</code> object.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">(</span><span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello Rxjs</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// same</span>

<span class="cm">/*
const observable = Rx.Observable.create(function subscribe(observer) {
  const id = setInterval(() =&gt; {
    observer.next('Hello Rxjs');
  }, 1000);
});

*/</span>

</code></pre></div></div>

<p>Bạn hoàn toàn có thể sử dụng <code class="language-plaintext highlighter-rouge">new</code> hoặc <code class="language-plaintext highlighter-rouge">Rx.Observable.create</code>.</p>

<p>Ngoài operator như <code class="language-plaintext highlighter-rouge">create</code>, Rxjs mang đến cho bạn nhiều lựa chọn khác nhau để tạo mới một Observable như các operators: <code class="language-plaintext highlighter-rouge">of</code>, <code class="language-plaintext highlighter-rouge">from</code>, <code class="language-plaintext highlighter-rouge">interval</code>, etc. Chúng được đặt trong nhóm <strong>creation operators</strong>.</p>

<p>Ví dụ, bạn muốn tạo Observable cho một mảng các giá trị, lúc này bạn không cần dùng <code class="language-plaintext highlighter-rouge">Rx.Observable.create</code> rồi lặp qua các phần tử, xong gọi <code class="language-plaintext highlighter-rouge">next</code> nữa. Rxjs có cách dùng khác, vì đây là một usecase rất hay dùng và <code class="language-plaintext highlighter-rouge">create</code> là một low-level API.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">fromArrayObservable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>

</code></pre></div></div>

<h3 id="subscribing-observables">5.2 Subscribing to Observables</h3>

<p>Sau khi đã tạo xong một Observable, chúng ta cần <code class="language-plaintext highlighter-rouge">invoke</code> bằng cách <code class="language-plaintext highlighter-rouge">subscribe</code> vào như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<blockquote>
  <p>Subscribing to an Observable is like calling a function, providing callbacks where the data will be delivered to.</p>

</blockquote>

<p>Vậy nên chúng ta call một function <code class="language-plaintext highlighter-rouge">n</code> lần, chúng ta sẽ có <code class="language-plaintext highlighter-rouge">n</code> lần thực thi. Tương tự như thế, khi chúng ta <code class="language-plaintext highlighter-rouge">subscribe</code> vào một Observable <code class="language-plaintext highlighter-rouge">m</code> lần, thì có <code class="language-plaintext highlighter-rouge">m</code> lần thực thi, một lời gọi <code class="language-plaintext highlighter-rouge">subscribe</code> giống như một cách để Observable bắt đầu thực thi.</p>

<h3 id="executing-observables">5.3 Executing Observables</h3>

<p>Phần code khi chúng ta khởi tạo Observable <code class="language-plaintext highlighter-rouge">Rx.Observable.create(function subscribe(observer) {...})</code> chính là “Observable execution”. Giống như khai báo một function, phần code này để thực hiện một số hành động, xử lý nào đó; chúng là <code class="language-plaintext highlighter-rouge">lazy computation</code> - chỉ thực thi khi Observer thực hiện subscribe.</p>

<p>Có ba kiểu giá trị mà một Observable Execution có thể gửi đi:</p>

<ul class="tpc__list">
  <li>“Next” notification: gửi đi một giá trị, có thể là bất kỳ kiểu dữ liệu nào như Number, a String, an Object, etc.</li>
  <li>“Error” notification: gửi đi một JavaScript Error hoặc exception.</li>
  <li>“Complete” notification: không gửi đi một giá trị nào, nhưng nó gửi đi một tín hiệu để báo rằng stream này đã completed, mục đích để Observer có thể thực hiện một hành động nào đó khi stream completed.</li>
</ul>

<p>Next notifications thường được sử dụng rộng rãi, nó cực kỳ quan trọng, vì nó gửi đi dữ liệu cần thiết cho một Observer.</p>

<p>Error và Complete notifications có thể chỉ xảy ra duy nhất một lần trong một <strong>Observable Execution</strong>.
Lưu ý rằng, chỉ có 1 trong 2 loại tín hiệu trên được gửi đi, nếu đã complete thì không có error, nếu có error thì không có complete. (Chúng không thuộc về nhau :D). Và nếu đã gửi đi complete, hoặc error signal, thì sau đó không có dữ liệu nào được gửi đi nữa. Tức là stream đã close.</p>

<blockquote>
  <p>In an Observable Execution, zero to infinite Next notifications may be delivered. If either an Error or Complete notification is delivered, then nothing else can be delivered afterwards.</p>

</blockquote>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">((</span><span class="nx">observer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// Is not delivered because it would violate the contract</span>
<span class="p">});</span>

</code></pre></div></div>
<p>Khi Subscribe vào observable được tạo ở trên, bạn có thể thấy được kết quả như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span>
  <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// result</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="dl">"</span><span class="s2">done</span><span class="dl">"</span>

</code></pre></div></div>

<p>Lưu ý rằng trong ví dụ trên, tôi đã <code class="language-plaintext highlighter-rouge">invoke</code> Observable bằng cách <code class="language-plaintext highlighter-rouge">subscribe</code> với 3 callbacks riêng biệt cho 3 loại signals tương ứng, về mặt xử lý phía sâu bên trong sẽ convert về Observer object có dạng.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// sử dụng để subscribe</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>

</code></pre></div></div>

<h3 id="disposing-observables">5.4 Disposing Observable Executions</h3>

<p>Bởi vì quá trình thực thi Observable có thể lặp vô hạn, hoặc trong trường hợp nào đó bạn muốn thực hiện hủy việc thực thi vì việc này không còn cần thiết nữa - dữ liệu đã lỗi thời, có dữ liệu khác thay thế. Các bạn có thể liên tưởng tới việc close websocket stream, removeEvenListener cho một element nào đó đã bị loại bỏ khỏi DOM chẳng hạn.</p>

<p>Observable có cơ chế tương ứng, cho phép chúng ta hủy việc thực thi. Đó là khi <code class="language-plaintext highlighter-rouge">subscribe</code> được gọi, một Observer sẽ bị gắn với một Observable execution mới được tạo, sau đó nó sẽ trả về một object thuộc type Subscription. Kiểu dữ liệu này có một method <code class="language-plaintext highlighter-rouge">unsubscribe</code> khi chúng ta gọi đến, nó sẽ thực hiện cơ chế để hủy việc thực thi.</p>

<p>Lưu ý: nếu bạn tạo Observable bằng <code class="language-plaintext highlighter-rouge">create</code> hoặc <code class="language-plaintext highlighter-rouge">new</code> thì bạn phải tự thiết lập cơ chế để hủy.</p>

<blockquote>
  <p>When you subscribe, you get back a Subscription, which represents the ongoing execution. Just call unsubscribe() to cancel the execution.</p>
</blockquote>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kd">function</span> <span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// Keep track of the interval resource</span>
  <span class="kd">const</span> <span class="nx">intervalID</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">value</span><span class="o">++</span><span class="p">);</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

  <span class="c1">// Provide a way of canceling and disposing the interval resource</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">unsubscribe</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">intervalID</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">subscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="rxjs-observer">6. Observer</h2>

<p>Observer là một Consumer những dữ liệu được gửi bởi Observable. Observer là một object chứa một tập 3 callbacks tương ứng cho mỗi loại notification được gửi từ Observable: <code class="language-plaintext highlighter-rouge">next</code>, <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">complete</code>.</p>

<p>Một Observer có dạng như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a next value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got an error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a complete notification</span><span class="dl">'</span><span class="p">),</span>
<span class="p">};</span>

</code></pre></div></div>

<p>Observer được cung cấp là tham số đầu vào của <code class="language-plaintext highlighter-rouge">subscribe</code> để kích hoạt Observable execution.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>

</code></pre></div></div>

<blockquote>
  <p>Observers are just objects with three callbacks, one for each type of notification that an Observable may deliver.</p>
</blockquote>

<p>Observe có thể chỉ có một số callbacks trong bộ 3 callbacks kể trên (có thể là một object không có callback nào trong bộ kể trên, trường hợp này ít dùng đến).</p>

<p>Như tôi đã đề cập từ trước, <code class="language-plaintext highlighter-rouge">observable.subscribe</code> sẽ chuẩn hóa các callbacks thành Observer object tương ứng, <strong>bạn có thể truyền vào các hàm rời rạc nhau, nhưng cần lưu ý truyền đúng thứ tự callback</strong>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a next value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got an error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a complete notification</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// tương đương với</span>

<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a next value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got an error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a complete notification</span><span class="dl">'</span><span class="p">),</span>
<span class="p">};</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>

</code></pre></div></div>

<p>Lưu ý: Nếu bạn không muốn truyền error handler function vào, hãy truyền <code class="language-plaintext highlighter-rouge">null</code>/<code class="language-plaintext highlighter-rouge">undefined</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a next value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="kc">null</span><span class="p">,</span>
  <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Observer got a complete notification</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

</code></pre></div></div>

<h2 id="rxjs-subscription">7. Subscription</h2>

<p>Subscription là một object đại diện cho một nguồn tài nguyên có khả năng hủy được, thông thường trong Rxjs là hủy Observable execution. Subscription có chứa một method quan trọng <code class="language-plaintext highlighter-rouge">unsubscribe</code> (từ Rxjs 5), khi method này được gọi, execution sẽ bị hủy.</p>

<p>Ví dụ: chúng ta có một đồng hồ đếm thời gian, mỗi giây sẽ gửi đi một giá trị, giả sử sau khi chạy 5s chúng ta cần hủy phần thực thi này.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">subscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">5000</span><span class="p">);</span>

</code></pre></div></div>

<blockquote>
  <p>A Subscription essentially just has an unsubscribe() function to release resources or cancel Observable executions.</p>
</blockquote>

<p>Một Subscription có thể chứa trong nó nhiều Subscriptions con, khi Subscription <code class="language-plaintext highlighter-rouge">unsubscribe</code>, các Subscriptions con cũng sẽ <code class="language-plaintext highlighter-rouge">unsubscribe</code>.</p>

<p>Ở Subscription cha, chúng ta có thể gọi method <code class="language-plaintext highlighter-rouge">add</code> để thêm các Subscriptions con mà phụ thuộc Subscription cha này.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">bar</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">700</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscription</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">childSub</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">));</span>

<span class="nx">subscription</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">childSub</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Unsubscribes BOTH subscription and childSub</span>
  <span class="nx">subscription</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>


</code></pre></div></div>

<h2 id="rxjs-cold-hot-observables">8. Cold Observables vs Hot Observables</h2>

<blockquote>
  <p>Cold Observables: Producers created <strong>inside</strong></p>
</blockquote>

<p>Một observable là “cold” nếu Producer được tạo ra và quản lý bên trong nó.</p>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="nx">x</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
	<span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

</code></pre></div></div>

<p>Kết quả là sau 1s thì lần <code class="language-plaintext highlighter-rouge">subscribe</code> đầu tiên có in ra 15, và lần <code class="language-plaintext highlighter-rouge">subscribe</code> thứ 2 in ra 5. Chúng không có cùng giá trị của <code class="language-plaintext highlighter-rouge">x</code>.</p>

<p>Giờ thay đổi chút bằng việc move khai báo biến <code class="language-plaintext highlighter-rouge">x</code> ra ngoài <code class="language-plaintext highlighter-rouge">create</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
  <span class="nx">x</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
	<span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">value</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

</code></pre></div></div>

<p>Lần này, sau 1s thì cả 2 execution đều in ra giá trị là 15.</p>

<p>Đây chính là ví dụ về Hot Observables.</p>

<blockquote>
  <p>Hot Observables: Producers created <strong>outside</strong></p>

</blockquote>

<h2 id="rxjs-subject">9. Subject</h2>

<p>Giả sử chúng ta có đoạn code sau đây:</p>

<p>Ở đây mình mong muốn sau khi <code class="language-plaintext highlighter-rouge">observerBaz</code> chạy 1.5s thì <code class="language-plaintext highlighter-rouge">observerBar</code> sẽ nhận được giá trị hiện tại mà <code class="language-plaintext highlighter-rouge">observerBaz</code> đang nhận.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">observerBaz</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observerBar</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerBaz</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerBar</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1500</span><span class="p">);</span>

</code></pre></div></div>

<p>Kết quả khi chạy chương trình:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">first next: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second done</span><span class="dl">"</span>

</code></pre></div></div>

<p>Oh well, <code class="language-plaintext highlighter-rouge">observerBaz</code> và <code class="language-plaintext highlighter-rouge">observerBar</code> tạo ra các execution khác nhau của riêng chúng, chúng ta không kết nối chúng đến với nhau theo cách trên được.</p>

<p>Có cách nào để share execution giữa nhiều Observers không?</p>

<p>Lúc này, chúng ta cần đến một object làm cầu nối ở giữa để làm nhiệm vụ tạo ra Observable execution và share dữ liệu ra cho những Observers khác.</p>

<p>OK, tiến hành thêm một số code nữa.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">observerB</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">observers</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">addObserver</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
  <span class="p">},</span>
  
  <span class="c1">// this part is an Observer</span>
  <span class="na">next</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observerBaz</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observerBar</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">observerB</span><span class="p">.</span><span class="nx">addObserver</span><span class="p">(</span><span class="nx">observerBaz</span><span class="p">);</span>

<span class="c1">// only subscribe bridge observer</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerB</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observerB</span><span class="p">.</span><span class="nx">addObserver</span><span class="p">(</span><span class="nx">observerBar</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1500</span><span class="p">);</span>

</code></pre></div></div>

<p>Object <code class="language-plaintext highlighter-rouge">observerB</code> có chưa method <code class="language-plaintext highlighter-rouge">addObserver</code> đây chính là khuôn mẫu của “Observer-Pattern”.</p>

<p>Giờ đây chúng ta có thể có được kết quả như mong muốn.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">first next: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first next: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second next: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">first done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">second done</span><span class="dl">"</span>

</code></pre></div></div>

<p>Bây giờ, nếu chúng ta thay đổi một chút:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">observerB</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">observers</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">subscribe</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">observer</span><span class="p">);</span>
  <span class="p">},</span>
  
  <span class="c1">// this part is an Observer</span>
  <span class="na">next</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="na">error</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observerBaz</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">first done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">observerBar</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">second done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">observerB</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerBaz</span><span class="p">);</span>

<span class="c1">// only subscribe bridge observer</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerB</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">observerB</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerBar</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">1500</span><span class="p">);</span>

</code></pre></div></div>

<p>Giờ bạn có thể thấy, <code class="language-plaintext highlighter-rouge">observerB</code> trông giống như một Observable, nó lại còn giống như Observer, hơn nữa nó có thể gửi signals cho nhiều Observers mà nó đang quản lý. Đây chính là cấu trúc hybrid của Subject.</p>

<blockquote>
  <p>A Subject is like an Observable, but can multicast to many Observers. Subjects are like EventEmitters: they maintain a registry of many listeners.</p>

</blockquote>

<p><strong>Mỗi Subject là một Observable</strong>: bạn có thể <code class="language-plaintext highlighter-rouge">subscribe</code> vào nó, cung cấp cho nó một Observer và bạn có thể nhận data tương ứng.</p>

<p><strong>Mỗi Subject là một Observer</strong>: bên trong Subject có chứa các method <code class="language-plaintext highlighter-rouge">next</code>, <code class="language-plaintext highlighter-rouge">error</code>, <code class="language-plaintext highlighter-rouge">complete</code> tương ứng để bạn có thể <code class="language-plaintext highlighter-rouge">subscribe</code> vào Observable chẳng hạn.
Khi cần gửi dữ liệu cho các Observers mà Subject đang quản lý, bạn chỉ cần gọi hàm tương ứng.</p>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Subject</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">Subject</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: Hello</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: Hello</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: Subject</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: Subject</span><span class="dl">"</span>

</code></pre></div></div>

<p>Hoặc truyền vào một Observable:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Subject</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// subject.next('Hello');</span>
<span class="c1">// subject.next('Subject');</span>

<span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 2</span><span class="dl">"</span>

</code></pre></div></div>

<p>Với phương pháp kể trên, chúng ta đã cơ bản chuyển đổi từ một unicast Observable execution sang multicast, bằng cách sử dụng Subject.</p>

<p><strong>unicast</strong>: giống như bạn vào Youtube, mở video nào đó đã được thu sẵn và xem, nó play từ đầu đến cuối video. Một người khác vào xem, Youtube cũng sẽ phát từ đầu đến cuối như thế, hai người không có liên quan gì về thời gian hiện tại của video mà mình đang xem.</p>

<p><strong>multicast</strong>: cũng là hai người (có thể nhiều hơn) vào xem video ở Youtube, nhưng video đó đang phát Live (theo dõi một show truyền hình, hay một trận bóng đá Live chẳng hạn). Lúc này Youtube sẽ phát video Live, và những người vào xem video đó sẽ có cùng một thời điểm của video đó (cùng thời điểm của trận đấu đang diễn ra chẳng hạn).</p>

<h3 id="rxjs-BehaviorSubject">9.1 BehaviorSubject</h3>

<p>Một trong các biến thể của Subject đó là BehaviorSubject, nó là biến thế có khái niệm về “the current value”. BehaviorSubject lưu trữ lại giá trị mới emit gần nhất để khi một Observer mới subscribe vào, nó sẽ emit giá trị đó ngay lập tức cho Observer vừa rồi.</p>

<blockquote>
  <p>BehaviorSubjects are useful for representing “values over time”. For instance, an event stream of birthdays is a Subject, but the stream of a person’s age would be a BehaviorSubject.</p>
</blockquote>

<p>Hay như sử dụng BehaviorSubject để chia sẻ thông tin user hiện tại đang đăng nhập hệ thống cho các component khác nhau trong Angular chẳng hạn.</p>

<p>Lưu ý: BehaviorSubject yêu cầu phải có giá trị khởi tạo khi tạo ra subject.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">BehaviorSubject</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// 0 is the initial value</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">//result</span>
<span class="nl">observerA</span><span class="p">:</span> <span class="mi">0</span>
<span class="nx">observerA</span><span class="p">:</span> <span class="mi">1</span>
<span class="nx">observerA</span><span class="p">:</span> <span class="mi">2</span>
<span class="nx">observerB</span><span class="p">:</span> <span class="mi">2</span>
<span class="nx">observerA</span><span class="p">:</span> <span class="mi">3</span>
<span class="nx">observerB</span><span class="p">:</span> <span class="mi">3</span>

</code></pre></div></div>

<h3 id="rxjs-ReplaySubject">9.2 ReplaySubject</h3>

<p>Một ReplaySubject tương tự như một BehaviorSubject khi nó có thể gửi những dữ liệu trước đó cho Observer mới subscribe, nhưng nó có thể lưu giữ nhiều giá trị (có thể là toàn bộ giá trị của stream từ thời điểm ban đầu).</p>

<p>Tham số đầu vào của ReplaySubject có thể là:</p>

<p>buffer: là số lượng phần tử tối đa có thể lưu trữ.</p>

<p>windowTime: (ms) thời gian tối đa tính đến thời điểm gần nhất emit value.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">ReplaySubject</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// buffer 3 values for new subscribers</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 5</span><span class="dl">"</span>

</code></pre></div></div>

<p>Hoặc kết hợp buffer với windowTime:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">ReplaySubject</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span> <span class="cm">/* windowTime */</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">),</span> <span class="mi">200</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 6</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 6</span><span class="dl">"</span>
<span class="p">...</span>

</code></pre></div></div>

<p>Trong ví dụ trên sau 1s chỉ có giá trị 3, 4 và 5 là được emit trong 500ms gần nhất và nằm trong buffer nên được replay lại cho <code class="language-plaintext highlighter-rouge">observerB</code>.</p>

<h3 id="rxjs-AsyncSubject">9.3 AsyncSubject</h3>

<p>Đây là biến thể mà chỉ emit giá trị cuối cùng của Observable execution cho các observers, và chỉ khi execution complete.</p>

<p>Lưu ý:</p>

<p>Nếu stream không complete thì không có gì được emit cả.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">AsyncSubject</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 5</span><span class="dl">"</span>

</code></pre></div></div>

<h3 id="rxjs-SubjectComplete">9.4 Subject Complete</h3>

<p>Khi BehaviorSubject complete, thì các Observers subscribe vào sau đó sẽ chỉ nhận được <code class="language-plaintext highlighter-rouge">complete</code> signal.</p>

<p>Khi ReplaySubject complete, thì các Observers subscribe vào sau đó sẽ được emit tất cả các giá trị lưu trữ trong buffer, sau đó mới thực thi <code class="language-plaintext highlighter-rouge">complete</code> của Observer.</p>

<p>Kể cả khi AsyncSubject complete rồi, Observer vẫn có thể subscribe vào được và vẫn nhận giá trị cuối cùng.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">BehaviorSubject</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// 0 is the initial value</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerC: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerC: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerC: done</span><span class="dl">"</span>
<span class="c1">// ===========================================</span>

<span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">ReplaySubject</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">),</span> <span class="mi">200</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
  <span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
    <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: done</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: done</span><span class="dl">"</span>

<span class="c1">// ===========================================</span>

<span class="kd">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">AsyncSubject</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerA: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>

<span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
  <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">observerB: done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">observerA: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerA: done</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">observerB: done</span><span class="dl">"</span>

</code></pre></div></div>

<h2 id="rxjs-Operators">10. Operators</h2>

<p>Trong Rxjs chúng ta thấy có vô số các method/static method được cung cấp, khiến nó trở nên vô cùng mạnh mẽ và hữu dụng.</p>

<p>Vậy Operator là gì?</p>

<blockquote>
  <p>An Operator is a function which creates a new Observable based on the current Observable. This is a pure operation: the previous Observable stays unmodified.</p>
</blockquote>

<p>Operator là một pure function. Với cùng một giá trị đầu vào, chúng ta sẽ luôn có cùng một giá trị ở đầu ra.</p>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// pure function</span>
<span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// 11</span>
<span class="nx">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// 11</span>

<span class="c1">// impure function</span>

<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">addImpure</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">x</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">addImpure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// 12</span>
<span class="nx">addImpure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// 13</span>

</code></pre></div></div>

<p>Operator nhận đầu vào là một Observable, sau đó xử lý và tạo mới mội Observable để trả về, và giữ Observable đầu vào không bị thay đổi gì.</p>

<p>Ví dụ, chúng ta tạo một Operator nhận đầu vào là một function, giống như Array <code class="language-plaintext highlighter-rouge">map</code> chẳng hạn.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">observable</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
      <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">x</span><span class="p">)),</span>
      <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
      <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">()</span>
    <span class="p">});</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Bây giờ chúng ta có thể tạo một Observable như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">amap</span> <span class="o">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">foo</span><span class="p">,</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">observerM</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">amap</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerM</span><span class="p">);</span>

<span class="c1">// result</span>
<span class="dl">"</span><span class="s2">next: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 5</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 10</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 15</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">next: 20</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">done</span><span class="dl">"</span>

</code></pre></div></div>

<h3 id="InstancevsStaticOperators">10.1 Instance operators vs static operators</h3>

<p>Thông thường <strong>static operators</strong> là các operators được gắn với <code class="language-plaintext highlighter-rouge">class</code> Observable, chúng được dùng phổ biến để tạo mới Observable.</p>

<p>Ví dụ như các operator <code class="language-plaintext highlighter-rouge">of</code>, <code class="language-plaintext highlighter-rouge">from</code>, <code class="language-plaintext highlighter-rouge">interval</code>, <code class="language-plaintext highlighter-rouge">fromPromise</code>, <code class="language-plaintext highlighter-rouge">empty</code>, etc.</p>

<p><strong>Instance operators</strong>: các operators này gắn với một instance của <code class="language-plaintext highlighter-rouge">class</code> Observable.</p>

<p>Giả sử chúng ta tạo operator <code class="language-plaintext highlighter-rouge">mmap</code> như sau, thì kết quả cũng được tương tự như trên:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mmap</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">observer</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
      <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nx">x</span><span class="p">)),</span>
      <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">),</span>
      <span class="na">complete</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">complete</span><span class="p">()</span>
    <span class="p">});</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// invoke</span>

<span class="kd">const</span> <span class="nx">amap</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">mmap</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">*</span> <span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">observerM</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">next</span><span class="p">:</span> <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">next: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">x</span><span class="p">),</span>
  <span class="na">error</span><span class="p">:</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">error: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">),</span>
  <span class="na">complete</span><span class="p">:</span> <span class="nx">_</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">done</span><span class="dl">'</span><span class="p">)</span>
<span class="p">};</span>

<span class="nx">amap</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerM</span><span class="p">);</span>

</code></pre></div></div>

<blockquote>
  <p>Instance operators are functions that use the this keyword to infer what is the input Observable.</p>

  <p>Static operators are pure functions attached to the Observable class, and usually are used to create Observables from scratch.</p>
</blockquote>

<p>Operators được chia vào nhiều nhóm khác nhau, mỗi nhóm có một mục đích sử dụng:</p>

<ul class="tpc__list">
  <li>Creation Operators.</li>
  <li>Transformation Operators.</li>
  <li>Filtering Operators.</li>
  <li>Combination Operators.</li>
  <li>Error Handling Operators.</li>
  <li>Utility Operators.</li>
  <li>Multicasting Operators.</li>
  <li>Conditional and Boolean Operators.</li>
  <li>Mathematical and Aggregate Operators</li>
</ul>

<p>Sau đây chúng ta sẽ tìm hiểu một số operators chính hay dùng đến.</p>

<h3 id="rxjs-CreationOperators">10.2 Creation Operators</h3>

<p>Từ đầu đến giờ chúng ta đã quen với sử dụng <code class="language-plaintext highlighter-rouge">create</code> operator để tạo ra Observable, ngoài ra chúng ta còn có một số operators khác để tạo Observable từ những common usecase.</p>

<p>Ví dụ để tạo Observable từ một số static values, chúng ta có thể dùng <code class="language-plaintext highlighter-rouge">of</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span> <span class="c1">// 100</span>

</code></pre></div></div>

<p>Hoặc có thể dùng <code class="language-plaintext highlighter-rouge">of</code> với nhiều tham số đầu vào:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>

</code></pre></div></div>

<p>Lưu ý: với các static values như ví dụ trên, chúng được gửi đi sync. (mặc đinh nếu không có tác động của Scheduler).</p>

<p>Sau khi gửi đi hết dữ liệu, nó sẽ gửi <code class="language-plaintext highlighter-rouge">complete</code> signal.</p>

<p>Một số operators tương tự:</p>

<ul class="tpc__list">
  <li>interval: thay vì tự tạo interval với setInterval, chúng ta dùng operator này cho mục đích tương tự.</li>
  <li>timer: giống như setTimeout, sau một khoảng thời gian nào đó thì emit value.</li>
  <li>throw: để bắn ra error.</li>
  <li>empty: không gửi gì khác ngoài <code class="language-plaintext highlighter-rouge">complete</code> signal.</li>
  <li>never: không gửi bất kỳ loại signals nào.</li>
</ul>

<p><strong>Tổng quát cho các loại event</strong> thì chúng ta có <code class="language-plaintext highlighter-rouge">fromEventPattern</code>:</p>

<blockquote>
  <p>Converts any addHandler/removeHandler API to an Observable.</p>
</blockquote>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">function</span> <span class="nx">addClickHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">removeClickHandler</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">handler</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">clicks</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEventPattern</span><span class="p">(</span>
  <span class="nx">addClickHandler</span><span class="p">,</span>
  <span class="nx">removeClickHandler</span>
<span class="p">);</span>
<span class="nx">clicks</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p><strong>Để làm việc với DOM event</strong> chúng ta có <code class="language-plaintext highlighter-rouge">fromEvent</code> operator, nó là bản chi tiết của <code class="language-plaintext highlighter-rouge">fromEventPattern</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">event</span> <span class="o">=&gt;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Khi click vào trang web, chúng ta có thể thấy console hiển thị tọa độ X ra.</p>

<p><strong>Để convert từ Promise sang Observable</strong> chúng ta có <code class="language-plaintext highlighter-rouge">fromPromise</code> operator:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">function</span> <span class="nx">getInfo</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">resolve</span><span class="p">({</span>
        <span class="na">site</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tiepphan.com</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">post</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Rxjs và Reactive Programming</span><span class="dl">'</span>
      <span class="p">});</span>
    <span class="p">},</span> <span class="mi">300</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromPromise</span><span class="p">(</span><span class="nx">getInfo</span><span class="p">());</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// result after 300ms</span>
<span class="p">[</span><span class="nx">object</span> <span class="nb">Object</span><span class="p">]</span> <span class="p">{</span>
  <span class="nl">post</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Rxjs và Reactive Programming</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">site</span><span class="p">:</span> <span class="dl">"</span><span class="s2">tiepphan.com</span><span class="dl">"</span>
<span class="p">}</span>

</code></pre></div></div>

<p><strong>Tạo mới một Observable từ Array, array-like object, Promise, iterable object, hoặc Observable-like object</strong> chúng ta dùng <code class="language-plaintext highlighter-rouge">from</code> operator:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">array</span><span class="p">);</span>
<span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// result</span>
<span class="mi">5</span>
<span class="mi">10</span>
<span class="mi">15</span>

</code></pre></div></div>

<p><strong>repeat</strong>: <code class="language-plaintext highlighter-rouge">repeat(count: number): Observable</code>
Repeat khi nào Observable complete, có thể giới hạn số lần repeat.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">array</span><span class="p">).</span><span class="nx">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// result</span>
<span class="mi">5</span>
<span class="mi">10</span>
<span class="mi">15</span>
<span class="mi">5</span>
<span class="mi">10</span>
<span class="mi">15</span>

</code></pre></div></div>

<p>Còn nhiều các operators khác nữa như <code class="language-plaintext highlighter-rouge">repeatWhen</code>, các bạn vào trang chủ của ReactiveX để xem thêm.</p>

<h3 id="rxjs-TransformationOperators">10.3 Transformation Operators</h3>

<p>Transformation Operators dùng để chuyển đổi giá trị của Observable từ dạng này sang sang dạng khác.</p>

<p>Hay gặp nhất có lẽ là <code class="language-plaintext highlighter-rouge">map</code>, nó tương tự như <code class="language-plaintext highlighter-rouge">mmap</code> operator mà chúng ta đã tạo ở trên (tạo để tìm hiểu cơ chế hoạt động).</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit (1,2,3,4,5)</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
<span class="c1">//add 10 to each value</span>
<span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">//output: 11,12,13,14,15</span>
<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">example</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Các bạn có thể dùng <code class="language-plaintext highlighter-rouge">map</code> để chuyển đổi theo bất kỳ yêu cầu nào của các bạn. Ví dụ khi làm việc với Response object của HTTP, lúc này các bạn có thể convert từ JSON thành object như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">API_ENDPOINT</span><span class="p">)</span> <span class="c1">// return Observable</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

</code></pre></div></div>

<p>Khi bạn muốn luôn luôn trả về 1 giá trị cho các giá trị được emit, lúc này bạn có thể dùng <code class="language-plaintext highlighter-rouge">mapTo</code> operator.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit every click on document</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//map all emissions to one value</span>
<span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">mapTo</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">//output: (click) 10...10...</span>
<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">example</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p><strong>scan</strong>: <code class="language-plaintext highlighter-rouge">scan(accumulator: function, seed: any): Observable</code></p>

<p>Giống như Array <code class="language-plaintext highlighter-rouge">reduce</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit array as a sequence of values</span>
<span class="kd">const</span> <span class="nx">arraySource</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>

<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">arraySource</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span> <span class="p">(</span><span class="nx">acc</span><span class="p">,</span> <span class="nx">current</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">acc</span> <span class="o">+</span> <span class="nx">current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// result</span>
<span class="mi">1</span>
<span class="mi">3</span>
<span class="mi">6</span>
<span class="mi">10</span>
<span class="mi">15</span>

</code></pre></div></div>

<p><strong>buffer</strong>: <code class="language-plaintext highlighter-rouge">buffer(closingNotifier: Observable): Observable</code></p>

<p>Lưu trữ giá trị được emit ra và đợi đến khi <code class="language-plaintext highlighter-rouge">closingNotifier</code> emit thì emit những giá trị đó thành 1 array.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">interval$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">buffer$</span> <span class="o">=</span> <span class="nx">interval$</span><span class="p">.</span><span class="nx">buffer</span><span class="p">(</span><span class="nx">click$</span><span class="p">);</span>


<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">buffer$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Buffered Values: </span><span class="dl">'</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output có dạng</span>
<span class="dl">"</span><span class="s2">Buffered Values: </span><span class="dl">"</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="dl">"</span><span class="s2">Buffered Values: </span><span class="dl">"</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>

</code></pre></div></div>

<p><strong>bufferTime</strong>: <code class="language-plaintext highlighter-rouge">bufferTime(bufferTimeSpan: number, bufferCreationInterval: number, scheduler: Scheduler): Observable</code></p>

<p>Tương tự như <code class="language-plaintext highlighter-rouge">buffer</code>, nhưng emit values mỗi khoảng thời gian <code class="language-plaintext highlighter-rouge">bufferTimeSpan</code> ms.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">bufferTime</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">bufferTime</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">bufferTimeSub</span> <span class="o">=</span> <span class="nx">bufferTime</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Buffered with Time:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">Buffered with Time:</span><span class="dl">"</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="dl">"</span><span class="s2">Buffered with Time:</span><span class="dl">"</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="dl">"</span><span class="s2">Buffered with Time:</span><span class="dl">"</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">...</span>

</code></pre></div></div>

<p>Ngoài ra còn rất nhiều operators khác như <code class="language-plaintext highlighter-rouge">buffer</code>, và một số Operators chúng ta sẽ tìm hiểu ở phần sau “Higher Order Observables”.</p>

<h3 id="rxjs-FilteringOperators">10.4 Filtering Operators</h3>

<p>Filtering Operators mục đích để filter các giá trị được emit thỏa mãn điều kiện nào đó.</p>

<p><strong>filter</strong>: <code class="language-plaintext highlighter-rouge">filter(select: Function, thisArg: any): Observable</code></p>

<p>Giống như Array filter, operator này chỉ emit các value thỏa mãn <code class="language-plaintext highlighter-rouge">select</code> function. Nếu không có phần tử nào thỏa mãn thì không emit giá trị <code class="language-plaintext highlighter-rouge">next</code> nào cả.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">52</span><span class="p">]);</span>

<span class="kd">const</span> <span class="nx">filter$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">num</span> <span class="o">=&gt;</span> <span class="nx">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">filter$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Positive number: </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">Positive number: 12</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">Positive number: 45</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">Positive number: 52</span><span class="dl">"</span>

</code></pre></div></div>

<p><strong>take</strong>: <code class="language-plaintext highlighter-rouge">take(count: number): Observable</code></p>

<p>Emit tối đa <code class="language-plaintext highlighter-rouge">count</code> giá trị, rồi complete.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">take$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">take$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>

</code></pre></div></div>

<p><strong>takeUntil</strong>: <code class="language-plaintext highlighter-rouge">takeUntil(notifier: Observable): Observable</code></p>

<p>Emit value cho đến khi <code class="language-plaintext highlighter-rouge">notifier</code> emit thì dừng.</p>

<p>Rất hữu ích khi làm việc với Angular, các bạn có thể sử dụng để tạo ra trình auto-unsubscribe cho Observable. Vì khi complete thì nó tự <code class="language-plaintext highlighter-rouge">unsubscribe</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit value every 1s</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="c1">//after 5 seconds, emit value</span>
<span class="kd">const</span> <span class="nx">timer</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">timer</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
<span class="c1">//when timer emits after 5s, complete source</span>
<span class="kd">const</span> <span class="nx">takeUntil$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">takeUntil</span><span class="p">(</span><span class="nx">timer</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">takeUntil$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>

</code></pre></div></div>

<p><strong>takeWhile</strong>: <code class="language-plaintext highlighter-rouge">takeWhile(predicate: function(value, index): boolean): Observable</code></p>

<p>Còn emit value khi mà <code class="language-plaintext highlighter-rouge">predicate</code> còn trả về <code class="language-plaintext highlighter-rouge">false</code>. Một khi <code class="language-plaintext highlighter-rouge">predicate</code> trả về <code class="language-plaintext highlighter-rouge">true</code> thì dừng lại, complete.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit value start from 0 each 500ms</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="c1">//allow values until value from source is greater than 4, then complete</span>
<span class="kd">const</span> <span class="nx">takeWhile$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">takeWhile</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">takeWhile$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>

</code></pre></div></div>

<p><strong>skip</strong>: <code class="language-plaintext highlighter-rouge">skip(num: Number): Observable</code></p>

<p>Skip số lượng phần tử từ đầu stream đến <code class="language-plaintext highlighter-rouge">num</code>, các giá trị emit sau đó mới được emit.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit every 500ms</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="c1">//skip the first 5 emitted values, then take 4 values</span>
<span class="kd">const</span> <span class="nx">skip$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">skip</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">skip$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">//output:</span>
<span class="mi">5</span>
<span class="mi">6</span>
<span class="mi">7</span>
<span class="mi">8</span>

</code></pre></div></div>

<p>Tương tự như <code class="language-plaintext highlighter-rouge">takeUntil</code>, <code class="language-plaintext highlighter-rouge">takeWhile</code>, nhưng hành động skip thay vì take, chúng ta cũng có <code class="language-plaintext highlighter-rouge">skipUntil</code>, <code class="language-plaintext highlighter-rouge">skipWhile</code></p>

<p><code class="language-plaintext highlighter-rouge">take(1)</code> chúng ta có một cách viết khác <code class="language-plaintext highlighter-rouge">first</code>:</p>

<p><code class="language-plaintext highlighter-rouge">first(predicate: function, select: function)</code></p>

<p>Nếu không truyền vào <code class="language-plaintext highlighter-rouge">predicate</code> thì nó sẽ lấy phần tử đầu tiên, ngược lại sẽ lấy phần tử đầu tiên thỏa mãn <code class="language-plaintext highlighter-rouge">predicate</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
<span class="c1">// no arguments, emit first value</span>
<span class="kd">const</span> <span class="nx">first$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">first$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`First value: </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">First value: 1</span><span class="dl">"</span>

</code></pre></div></div>

<p>Ngược lại với <code class="language-plaintext highlighter-rouge">first</code> chúng ta sẽ có <code class="language-plaintext highlighter-rouge">last</code>: <code class="language-plaintext highlighter-rouge">last(predicate: function): Observable</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]);</span>
<span class="c1">// no arguments, emit last value</span>
<span class="kd">const</span> <span class="nx">last$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">last</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">last$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Last value: </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">Last value: 5</span><span class="dl">"</span>

</code></pre></div></div>

<p><strong>throttleTime</strong>: <code class="language-plaintext highlighter-rouge">throttleTime(duration: number, scheduler: Scheduler): Observable</code></p>

<p>Emit giá trị mới nhất khi một khoảng thời gian <code class="language-plaintext highlighter-rouge">duration</code> trôi qua.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// emit value every 1 second</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="cm">/*
  throttle for five seconds
  last value emitted before throttle ends will be emitted from source
*/</span>
<span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">throttleTime</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">example</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="mi">0</span>
<span class="mi">6</span>
<span class="mi">12</span>
<span class="p">...</span>

</code></pre></div></div>

<p>Rất hữu ích khi làm việc với các event fire liên tục như <code class="language-plaintext highlighter-rouge">click</code>, hay <code class="language-plaintext highlighter-rouge">mousemove</code> chẳng hạn.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mousemove$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">mousemove$</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p>Sử dụng với <code class="language-plaintext highlighter-rouge">throttleTime</code> để hạn chế event fire quá nhiều. Cứ sau 300ms thì emit giá trị mới nhất có được.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">mousemove$</span>
  <span class="p">.</span><span class="nx">throttleTime</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p><strong>debounceTime</strong>: <code class="language-plaintext highlighter-rouge">debounceTime(dueTime: number, scheduler: Scheduler): Observable</code></p>

<blockquote>
  <p>Discard emitted values that take less than the specified time between output</p>

</blockquote>

<p>Hay dùng khi bạn muốn đảm bảo người dùng thôi thao tác sau một khoảng thời gian <code class="language-plaintext highlighter-rouge">dueTime</code> thì emit giá trị. Giống như đảm bảo người dùng ngừng di chuyển chuột, hay ngừng gõ vào input chẳng hạn, để tránh phát sinh nhiều hành động không cần thiết.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mousemove$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">mousemove$</span>
  <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
</code></pre></div></div>

<p><strong>distinctUntilChanged</strong>: <code class="language-plaintext highlighter-rouge">distinctUntilChanged(compare: function): Observable</code></p>

<p>Chỉ emit value khi giá trị hiện tại khác với giá trị đã emit trước đó. Hay dùng để đảm bảo dữ liệu phải khác nhau thì mới thực thi hành động. Kết hợp cùng <code class="language-plaintext highlighter-rouge">debounceTime</code> hoặc <code class="language-plaintext highlighter-rouge">throttleTime</code> để làm việc khi người dùng nhập vào input, sau đó xử lý giá trị, và chỉ xử lý khi dữ liệu hiện tại khác với dữ liệu đã xử lý trước đó.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mousemove$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">mousemove$</span>
  <span class="p">.</span><span class="nx">debounceTime</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">distinctUntilChanged</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p>Khi bạn không di chuyển chuột mà click liên tục thì không có gì được emit cả.</p>

<p>Trên đây chỉ là một số Filter Operators hay dùng, các bạn có thể vào trang chủ của ReactiveX để tìm hiểu thêm những operators như <code class="language-plaintext highlighter-rouge">debounce</code>, <code class="language-plaintext highlighter-rouge">throttle</code>, etc.</p>

<h3 id="rxjs-CombinationOperators">10.5 Combination Operators</h3>

<p>Combination Operators: sử dụng để kết hợp các Observables lại với nhau.</p>

<p><strong>merge</strong>: có thể sử dụng cả instance và static operator. Dùng để merge nhiều Observables thành một Observable.</p>

<p><code class="language-plaintext highlighter-rouge">Rx.Observable.merge(observables: ...ObservableInput, concurrent: number): Observable</code></p>

<p><code class="language-plaintext highlighter-rouge">merge(input: Observable, concurrent: number): Observable</code></p>

<p><code class="language-plaintext highlighter-rouge">concurrent</code>: số lượng stream được phép chạy đồng thời.</p>

<p class="text-center"><img src="/assets/uploads/2017/09/rxjs-merge.png" alt="rxjs merge" class="img-responsive" /></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">700</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s3: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span>

</code></pre></div></div>

<p>Lúc này cả 3 cùng chạy đồng thời, nếu bạn muốn dùng instance operator thì thay như sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">s1</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">s2</span><span class="p">,</span> <span class="nx">s3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p>Giả sử bạn muốn chỉ 2 stream được chạy đồng thời:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">700</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s3: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span><span class="p">,</span>
  <span class="mi">2</span>
<span class="p">);</span>

<span class="c1">// const source = s1.merge(s2, s3, 2);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>
<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 1</span><span class="dl">"</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">s3</code> sẽ đợi cho <code class="language-plaintext highlighter-rouge">s1</code>, <code class="language-plaintext highlighter-rouge">s2</code> complete rồi mới bắt đầu chạy.</p>

<p><strong>concat</strong>: trong trường hợp bạn chỉ muốn 1 stream được chạy, các stream khác phải đợi stream trước complete.</p>

<p>Tương đương với <code class="language-plaintext highlighter-rouge">merge(...observables, 1)</code>. Giống như Array <code class="language-plaintext highlighter-rouge">concat</code> vậy.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span><span class="p">,</span>
  <span class="mi">1</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">csource</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 3</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s3: 1</span><span class="dl">"</span>

</code></pre></div></div>

<p>Trong nhiều trường hợp bạn muốn tạo ra 1 Observable cho 1 giá trị, rồi dùng nó <code class="language-plaintext highlighter-rouge">concat</code> với một số Observables khác, lúc này chúng ta có một cách viết gọn hơn sử dụng <code class="language-plaintext highlighter-rouge">startWith</code> với cú pháp <code class="language-plaintext highlighter-rouge">startWith(an: Values): Observable</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">//emit (1,2,3)</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="c1">//start with 0</span>
<span class="kd">const</span> <span class="nx">stream</span> <span class="o">=</span>  <span class="nx">source</span><span class="p">.</span><span class="nx">startWith</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">//output: 0,1,2,3</span>

</code></pre></div></div>

<p><strong>combineLatest</strong>: <code class="language-plaintext highlighter-rouge">combineLatest(observables: ...Observable, project: function): Observable</code></p>

<p>combineLatest Operator có thể dùng cả static và instance.</p>

<p>Mỗi khi một Observable emit value, emit giá trị mới nhất từ tất cả <code class="language-plaintext highlighter-rouge">observables</code>, nhưng phải thỏa mãn các Observable khác cũng đã emit value.</p>

<p>Như trong ví dụ sau, khi <code class="language-plaintext highlighter-rouge">source</code> emit value, nó emit giá trị của <code class="language-plaintext highlighter-rouge">s1</code> lúc này là <code class="language-plaintext highlighter-rouge">2</code>, nhưng <code class="language-plaintext highlighter-rouge">s3</code> lúc này mới emit value đầu tiên.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">300</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s3: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>


<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">combineLatest</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s3: 0</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s3: 1</span><span class="dl">"</span><span class="p">]</span>

</code></pre></div></div>

<p>Hoặc trường hợp bạn muốn xử lý giá trị trước bằng <code class="language-plaintext highlighter-rouge">project</code> function:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">combineLatest</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">|</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">b</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">|</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">c</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 2|s2: 1|s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 3|s2: 1|s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4|s2: 1|s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4|s2: 2|s3: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4|s2: 2|s3: 1</span><span class="dl">"</span>

</code></pre></div></div>

<p class="text-center"><img src="/assets/uploads/2017/09/rxjs-combineLatest.png" alt="rxjs combineLatest" class="img-responsive" /></p>

<p><strong>withLatestFrom</strong>: <code class="language-plaintext highlighter-rouge">withLatestFrom(other: Observable, project: Function): Observable</code></p>

<p>Lưu ý: chỉ có thể sử dụng instance operator với <strong>withLatestFrom</strong>.</p>

<p>Sử dụng để emit value của Observable này <code class="language-plaintext highlighter-rouge">this</code> kết hợp với latest value của <code class="language-plaintext highlighter-rouge">other</code> Observable, nếu <code class="language-plaintext highlighter-rouge">other</code> chưa emit gì thì <code class="language-plaintext highlighter-rouge">this</code> có emit value cũng không emit gì cả.</p>

<p class="text-center"><img src="/assets/uploads/2017/09/rxjs-withLatestFrom.png" alt="rxjs withLatestFrom" class="img-responsive" /></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>


<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">s1</span><span class="p">.</span><span class="nx">withLatestFrom</span><span class="p">(</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">|</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 2|s2: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 3|s2: 0</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 4|s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 5|s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 6|s2: 1</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 7|s2: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 8|s2: 2</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">s1: 9|s2: 3</span><span class="dl">"</span>

</code></pre></div></div>

<p>Stream <code class="language-plaintext highlighter-rouge">s1</code> bị phụ thuộc vào <code class="language-plaintext highlighter-rouge">s2</code> trong giai đoạn đầu tiên, vì khi đó <code class="language-plaintext highlighter-rouge">s2</code> chưa emit gì, nên <code class="language-plaintext highlighter-rouge">s1</code> cũng không emit, đến khi <code class="language-plaintext highlighter-rouge">s2</code> bắt đầu emit thì những lần emit sau đó của <code class="language-plaintext highlighter-rouge">s1</code> sẽ kết hợp với giá trị mới nhất của <code class="language-plaintext highlighter-rouge">s2</code>.</p>

<p>Nếu bạn muốn mỗi khi có giá trị của stream emit thì emit giá trị mới nhất của các stream khác, lúc này bạn nên dùng <code class="language-plaintext highlighter-rouge">combineLatest</code>.
Chẳng hạn, bạn có search box với <code class="language-plaintext highlighter-rouge">n</code> fields để thiết lập điều kiện, và khi mỗi field thay đổi thì sẽ lấy danh sách mới dựa theo list các điều kiện kia chẳng hạn.</p>

<p><strong>forkJoin</strong>: <code class="language-plaintext highlighter-rouge">forkJoin(...observables, selector : function): Observable</code></p>

<p>Khi tất cả các Observables complete, emit giá trị cuối cùng của mỗi Observable.</p>

<p>Lưu ý: nếu còn một stream không complete, hoặc 1 stream không emit value nào <code class="language-plaintext highlighter-rouge">empty</code> thì không có gì được emit cả.</p>

<p>Chỉ có thể sử dụng static operator.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>


<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">forkJoin</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">|</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">s1: 9|s2: 3</span><span class="dl">"</span>

</code></pre></div></div>

<p>Không emit gì cả ngoài <code class="language-plaintext highlighter-rouge">complete</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">s3</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>


<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">forkJoin</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
  <span class="nx">s3</span><span class="p">,</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">a</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">|</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
    <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span>
    <span class="kc">null</span><span class="p">,</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">complete</span><span class="dl">"</span>

</code></pre></div></div>

<p><strong>zip</strong>: <code class="language-plaintext highlighter-rouge">zip(observables: *): Observable</code></p>

<p>Sau khi tất cả Observables emit value, thì emit 1 mảng các giá trị tương ứng (cùng index). Nếu một phần tử không emit gì cả <code class="language-plaintext highlighter-rouge">never</code>, hoặc complete ngay <code class="language-plaintext highlighter-rouge">empty</code>, thì không có gì emit cả. Trường hợp <code class="language-plaintext highlighter-rouge">empty</code> thì chỉ send <code class="language-plaintext highlighter-rouge">complete</code> signal.</p>

<blockquote>
  <p>The zip operator will subscribe to all inner observables, waiting for each to emit a value. Once this occurs, all values with the corresponding index will be emitted. This will continue until at least one inner observable completes.</p>
</blockquote>

<p class="text-center"><img src="/assets/uploads/2017/09/rxjs-zip.png" alt="rxjs zip" class="img-responsive" /></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">s1</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s1: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">s2</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="s2">`s2: </span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>


<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">zip</span><span class="p">(</span>
  <span class="nx">s1</span><span class="p">,</span>
  <span class="nx">s2</span><span class="p">,</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
    <span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">),</span>
    <span class="kc">null</span><span class="p">,</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">);</span>

<span class="c1">// output</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 0</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 0</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 1</span><span class="dl">"</span><span class="p">]</span>
<span class="p">[</span><span class="dl">"</span><span class="s2">s1: 2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">s2: 2</span><span class="dl">"</span><span class="p">]</span>
<span class="dl">"</span><span class="s2">complete</span><span class="dl">"</span>

</code></pre></div></div>

<h3 id="rxjs-ErrorHandlingOperators">10.5 Error Handling Operators</h3>

<p>Error Handling Operators sử dụng để handle error trong ứng dụng của bạn.</p>

<p><strong>catch</strong>: <code class="language-plaintext highlighter-rouge">catch(project : function): Observable</code></p>

<p>Thường được sử dụng rộng rãi để handle error.</p>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit error</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is an error!</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">//gracefully handle error, returning observable with error message</span>
<span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="s2">`I caught: </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">example</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">//output:</span>
<span class="dl">'</span><span class="s1">I caught: This is an error</span><span class="dl">'</span>

</code></pre></div></div>

<p><strong>retry</strong>: <code class="language-plaintext highlighter-rouge">retry(num: number): Observable</code></p>

<p>Sử dụng để restart lại stream trong trường hợp stream bị văng ra lỗi. Có thể giới hạn số lần retry bằng cách truyền vào tham số. Nếu không truyền vào, sẽ  luôn retry mỗi khi lỗi văng ra.</p>

<p>Chẳng hạn khi bạn reqest lên server để lấy dữ liệu, giả sử trong quá trình này bạn muốn request lại 2 lần nếu bị văng ra lỗi.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//emit value every 1s</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">//throw error for demonstration</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">val</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">){</span>
      <span class="k">return</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error!</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="c1">//retry 2 times on error</span>
  <span class="p">.</span><span class="nx">retry</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">example</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
     <span class="na">next</span><span class="p">:</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span>
     <span class="na">error</span><span class="p">:</span> <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">: Retried 2 times then quit!`</span><span class="p">)</span>
<span class="p">});</span>

<span class="c1">// output: </span>
<span class="dl">"</span><span class="s2">0..1..2..3..4..5...</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">0..1..2..3..4..5...</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">0..1..2..3..4..5...</span><span class="dl">"</span>
<span class="dl">"</span><span class="s2">Error!: Retried 2 times then quit!</span><span class="dl">"</span>

</code></pre></div></div>

<p><strong>retryWhen</strong>: <code class="language-plaintext highlighter-rouge">retryWhen(receives: (errors: Observable) =&gt; Observable, the: scheduler): Observable</code></p>

<p>Retry một Observable dựa vào một <code class="language-plaintext highlighter-rouge">errors</code> Observable emit value. <code class="language-plaintext highlighter-rouge">errors</code> Observable này chỉ emit <code class="language-plaintext highlighter-rouge">next</code> khi <code class="language-plaintext highlighter-rouge">source</code> Observable văng ra error, khi đó chúng ta có thể xác định khi nào lại subscribe vào <code class="language-plaintext highlighter-rouge">source</code> Observable lần nữa.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">retryWhen$</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">val</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">){</span>
     <span class="c1">//error will be picked up by retryWhen</span>
     <span class="k">throw</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">retryWhen</span><span class="p">(</span><span class="nx">errors</span> <span class="o">=&gt;</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">));</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">retryWhen$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">// output</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="mi">5</span>
<span class="c1">// error then wait 500ms</span>
<span class="mi">0</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="p">...</span>

</code></pre></div></div>

<h3 id="rxjs-UtilityOperators">10.6 Utility Observables</h3>

<p><strong>do</strong>: <code class="language-plaintext highlighter-rouge">do(nextOrObserver: function, error: function, complete: function): Observable</code></p>

<p>Dùng để thực hiện một hành động nào đó, và đảm bảo side-effect không ảnh hưởng tới source. Như ví dụ dưới đây, chúng ta đã thực hiện update value cho <code class="language-plaintext highlighter-rouge">val</code> trong <code class="language-plaintext highlighter-rouge">do</code>, nhưng không bị ảnh hưởng gì.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">source</span>
  <span class="p">.</span><span class="k">do</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`BEFORE: </span><span class="p">${</span><span class="nx">val</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
    
    <span class="c1">// do some stuff</span>
    <span class="nx">val</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span>
    <span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">val</span> <span class="o">+</span> <span class="mi">10</span>
  <span class="p">);</span>

<span class="kd">const</span> <span class="nx">subscribe</span> <span class="o">=</span> <span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// output</span>
<span class="dl">"</span><span class="s2">BEFORE MAP: 1</span><span class="dl">"</span>
<span class="mi">11</span>
<span class="dl">"</span><span class="s2">BEFORE MAP: 2</span><span class="dl">"</span>
<span class="mi">12</span>
<span class="dl">"</span><span class="s2">BEFORE MAP: 3</span><span class="dl">"</span>
<span class="mi">13</span>

</code></pre></div></div>

<p><strong>delay</strong>: <code class="language-plaintext highlighter-rouge">delay(delay: number | Date, scheduler: Scheduler): Observable</code></p>

<p>Delay emit value theo một khoảng thời gian cho trước.</p>

<p>Ví dụ chúng ta muốn delay 1s rồi mới bắt đầu emit value cho stream sau:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">));</span>

</code></pre></div></div>

<p>Và còn nhiều operators khác như <code class="language-plaintext highlighter-rouge">toPromise</code> trên trang chủ của ReactiveX.</p>

<h3 id="rxjs-HigherOrderOperators">10.7 Higher Order Observables</h3>

<p>Higher Order Observable (HOO) là một Observable trả về một Observable, nó giống như mảng nhiều chiều vậy - mảng 2 chiều chứa trong nó các mảng 1 chiều.</p>

<p>Ví dụ:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">source</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>
<span class="p">});</span>

</code></pre></div></div>

<p>Oh, nhìn thế này không ổn, phải có cách nào khác. Hãy quay lại ví dụ flatten Array ở trên, Observable cũng cung cấp cho chúng ta giải pháp để thực hiện flatten HOO.</p>

<p><strong>mergeMap</strong>: <code class="language-plaintext highlighter-rouge">mergeMap(project: function: Observable, resultSelector: function: any, concurrent: number): Observable</code></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">interval</span>
  <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">source</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">mergeAll</span><span class="p">();</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Hay có một cách viết ngắn gọn hơn, là alias của cách viết ở trên:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">interval</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">source</span><span class="p">);</span>

</code></pre></div></div>

<p>Bây giờ chúng ta thay đổi 1 chút, cứ mỗi lần click vào <code class="language-plaintext highlighter-rouge">document</code>, chúng ta sẽ start stream <code class="language-plaintext highlighter-rouge">interval</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Khi bạn click 3 lần chẳng hạn, sẽ tạo ra 3 stream chạy đồng thời (nếu cái trước chưa complete thì cái mới vẫn start), lúc này tương tự như <code class="language-plaintext highlighter-rouge">merge</code>, chúng ta có thể control có bao nhiêu stream được chạy đồng thời.</p>

<p>Ví dụ chúng ta giới hạn có 2 stream chạy đồng thời.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Tham số thứ 2 của <code class="language-plaintext highlighter-rouge">mergeMap</code> được đặt tên là <code class="language-plaintext highlighter-rouge">resultSelector</code>, tham số này cho phép chúng ta truyền vào 1 hàm để xử lý inner và outer Observable value.</p>

<p>Ví dụ, mình muốn lấy về tọa độ <code class="language-plaintext highlighter-rouge">X</code>, <code class="language-plaintext highlighter-rouge">Y</code> của stream <code class="language-plaintext highlighter-rouge">click$</code> kèm theo giá trị emit của <code class="language-plaintext highlighter-rouge">interval</code>:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">,</span> <span class="p">(</span><span class="nx">outer</span><span class="p">,</span> <span class="nx">inner</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">cord</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">x</span><span class="p">:</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
      <span class="na">y</span><span class="p">:</span> <span class="nx">outer</span><span class="p">.</span><span class="nx">clientY</span>
    <span class="p">};</span>
    
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">outer</span><span class="p">:</span> <span class="nx">cord</span><span class="p">,</span>
      <span class="na">inner</span><span class="p">:</span> <span class="nx">inner</span>
    <span class="p">};</span>
  <span class="p">},</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// output</span>
<span class="p">{</span>
  <span class="na">inner</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">outer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">x</span><span class="p">:</span> <span class="mi">132</span><span class="p">,</span>
    <span class="na">y</span><span class="p">:</span> <span class="mi">157</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>

</code></pre></div></div>

<p>Lưu ý: <code class="language-plaintext highlighter-rouge">flatMap</code> là một alias cho <code class="language-plaintext highlighter-rouge">mergeMap</code></p>

<p><strong>concatMap</strong>: <code class="language-plaintext highlighter-rouge">concatMap(project: function, resultSelector: function): Observable</code></p>

<p>Khi chỉ cho phép 1 stream được chạy, các stream khác phải đợi stream trước complete mới được chạy - tương tự <code class="language-plaintext highlighter-rouge">concat</code> thì chúng ta có operator <code class="language-plaintext highlighter-rouge">concatMap</code>.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">concatMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Khi bạn click vào document nhiều lần thì chỉ có 1 stream <code class="language-plaintext highlighter-rouge">interval</code> chạy tại 1 thời điểm, những stream khác phải đợi stream trước complete mới thực thi.</p>

<p>Tham số <code class="language-plaintext highlighter-rouge">resultSelector</code> cũng giống như <code class="language-plaintext highlighter-rouge">mergeMap</code>.</p>

<p><strong>switchMap</strong>: <code class="language-plaintext highlighter-rouge">switchMap(project: function: Observable, resultSelector: function(outerValue, innerValue, outerIndex, innerIndex): any): Observable</code></p>

<p>Chỉ cho phép 1 stream được chạy, nếu stream trước chưa <code class="language-plaintext highlighter-rouge">complete</code> thì <code class="language-plaintext highlighter-rouge">unsubscribe</code>.</p>

<p><code class="language-plaintext highlighter-rouge">switchMap</code> rất hữu ích khi làm việc với HTTP request, giả sử request cũ chưa trả về giá trị mà người dùng đã request dữ liệu mới thì chúng ta có thể cancel để tránh việc dư thừa hoặc xử lý sai dữ liệu (dữ liệu cũ hơn response sau dữ liệu mới hơn). Khi cần đảm bảo chỉ có stream mới nhất đang chạy.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">switchMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p>Khi bạn click vào document nhiều lần, nếu để ý bạn sẽ thấy những stream trước đó chưa complete sẽ bị cancel và start stream mới.</p>

<p>Ngoài ra nó còn hữu ích để tránh việc bị leak. Giả sử stream <code class="language-plaintext highlighter-rouge">interval</code> kia chạy vô hạn, nếu bạn không cancel trước đó thì chẳng mấy chốc ứng dụng của bạn sẽ crash khi người dùng click càng ngày càng nhiều lần.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">switchMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

<span class="c1">// vs mergeMap</span>

<span class="kd">const</span> <span class="nx">click$</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">fromEvent</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">foo$</span> <span class="o">=</span> <span class="nx">click$</span>
  <span class="p">.</span><span class="nx">mergeMap</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">interval</span><span class="p">);</span>

<span class="nx">foo$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">val</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">switchMap</code> cũng có <code class="language-plaintext highlighter-rouge">resultSelector</code> cho phép chúng ta tùy chọn dữ liệu cần emit.</p>

<p>Lưu ý: Trong hầu hết các trường hợp nếu bạn không có ý định gì đặc biệt thì nên dùng <code class="language-plaintext highlighter-rouge">switchMap</code> thay vì <code class="language-plaintext highlighter-rouge">mergeMap</code>.</p>

<h2 id="rxjs-summary">11. Tổng kết</h2>

<p>Trong bài này chúng ta đã tìm hiểu rất nhiều vấn đề về Reactive Programming với Rxjs, nhưng vẫn còn thiếu phần <strong>Multicasting</strong>, hi vọng mình sẽ làm xong phần đó trong thời gian tới.</p>

<p><strong>Marble diagrams</strong> các bạn có thể theo dõi trên trang chủ ReactiveX.</p>

<p><strong>Observable vs Promise</strong>: Khả năng mở rộng của Observable là rất lớn, nó bao quát được nhiều vấn đề mà Promise còn thiếu, như emit multiple values, hay cancel execution. Hơn nữa, nó đang trong giai đoạn phát triển để trở thành standard của EcmaScript (hiện tại đang ở stage-1), nên việc sử dụng Observable thay vì Promise có lẽ là điều chúng ta nên cân nhắc.</p>

<p>Các bạn quan tâm về Rxjs có thể theo dõi thêm các phần khác ở trong link tham khảo cuối bài.</p>

<p>Sau đây là một phần bonus để các bạn tạo ra một <code class="language-plaintext highlighter-rouge">Decorator</code> mà nó chịu trách nhiệm tự <code class="language-plaintext highlighter-rouge">unsubscribe</code> các subscription trong ứng dụng của bạn.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// `decorators.ts`</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs/Subject</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">Destroy</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">oldNgOnDestroy</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">ngOnDestroy</span><span class="p">;</span>
    <span class="nx">target</span><span class="p">.</span><span class="nx">ngOnDestroy</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">oldNgOnDestroy</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">oldNgOnDestroy</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">next</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> <span class="c1">// any kind of value</span>
      <span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">complete</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// `app.component.ts`</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">OnDestroy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Destroy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./decorators</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// alway import Observable, Subject, etc this way</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs/Subject</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs/Observable</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">rxjs/add/observable/interval</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">rxjs/add/operator/takeUntil</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">some-component</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`Tick: {{ tick }}`</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SomeComponent</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">Destroy</span><span class="p">()</span> <span class="nx">destroy$</span><span class="p">:</span> <span class="nx">Subject</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="nl">tick</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">takeUntil</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">destroy$</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">tick</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
      <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-root</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="s2">`
    &lt;button (click)="show = !show"&gt;Toggle&lt;/button&gt;

    &lt;some-component *ngIf="show"&gt;&lt;/some-component&gt;
  `</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./app.component.scss</span><span class="dl">'</span><span class="p">]</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nx">title</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">show</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="rxjs-references">12. Link tham khảo</h2>

<p><a href="http://reactivex.io/rxjs/manual/overview.html" target="_blank">Rxjs Official Docs</a></p>

<p><a href="https://www.learnrxjs.io/" target="_blank">learnrxjs.io</a></p>

<p><a href="http://rxmarbles.com/" target="_blank">rxmarbles.com</a></p>

<p><a href="https://rxviz.com/" target="_blank">Rx Visualizer</a></p>

<p><a href="https://medium.com/@benlesh/hot-vs-cold-observables-f8094ed53339" target="_blank">Hot vs Cold Observables</a></p>

<p><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754" target="_blank">The introduction to Reactive Programming you’ve been missing</a></p>

<p><a href="https://github.com/ReactiveX/rxjs" target="_blank">Rxjs Github Repo</a></p>
</p>
          </div>
        </div>
        <div class="col-md-3">
          <h2>Facebook</h2>
          <div class="fb-page" data-href="https://www.facebook.com/LapTrinhThatKyDieu/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/LapTrinhThatKyDieu/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/LapTrinhThatKyDieu/">Lập Trình Thật Kỳ Diệu</a></blockquote></div>
        </div>
      </div>
    </div>
  </section>
</div>
<p class="center-text" style="padding: 30px;">
  <a href="/blog">Back to blog</a>
</p>











    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="/about/">About</a></li>
            <li><a href="/contact/">Contact</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="#">Terms</a></li>
          </ul>
        </div>
        <p>Copyright &copy; 2017 to present - tiepphan.com All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

<!-- Js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.1.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>

<script src="/js/main.js"></script>

    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    </body>
</html>
