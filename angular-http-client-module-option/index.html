<!DOCTYPE html>
<html class="no-js">
  <head>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--<title>Angular HTTP Client Module - P2. Http Options và Demo Upload & Download Progress</title>-->
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Angular HTTP Client Module - P2. Http Options và Demo Upload &amp; Download Progress | Lập Trình Thật Kỳ Diệu</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Angular HTTP Client Module - P2. Http Options và Demo Upload &amp; Download Progress" />
<meta name="author" content="Tuan Anh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Cùng nhau khám phá về Http Client Options và demo upload file có progress nhé." />
<meta property="og:description" content="Cùng nhau khám phá về Http Client Options và demo upload file có progress nhé." />
<link rel="canonical" href="https://www.tiepphan.com/angular-http-client-module-option/" />
<meta property="og:url" content="https://www.tiepphan.com/angular-http-client-module-option/" />
<meta property="og:site_name" content="Lập Trình Thật Kỳ Diệu" />
<meta property="og:image" content="https://res.cloudinary.com/tuananh-asia/image/upload/v1591951988/HTTP%20CLIENT%20MODULE/angular-http-client_t5qody.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://res.cloudinary.com/tuananh-asia/image/upload/v1591951988/HTTP%20CLIENT%20MODULE/angular-http-client_t5qody.png" />
<meta property="twitter:title" content="Angular HTTP Client Module - P2. Http Options và Demo Upload &amp; Download Progress" />
<meta name="google-site-verification" content="Gcn3Y0oBud7gufI1PtszF7DFNgFOifgLRIaZAoLZWWU" />
<meta name="msvalidate.01" content="F160AE523B1846CBDC431CB91CB6613A" />
<script type="application/ld+json">
{"description":"Cùng nhau khám phá về Http Client Options và demo upload file có progress nhé.","url":"https://www.tiepphan.com/angular-http-client-module-option/","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://www.tiepphan.com/assets/logo.png"},"name":"Tuan Anh"},"image":"https://res.cloudinary.com/tuananh-asia/image/upload/v1591951988/HTTP%20CLIENT%20MODULE/angular-http-client_t5qody.png","headline":"Angular HTTP Client Module - P2. Http Options và Demo Upload &amp; Download Progress","dateModified":"2020-06-23T00:00:00+00:00","datePublished":"2020-06-23T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.tiepphan.com/angular-http-client-module-option/"},"author":{"@type":"Person","name":"Tuan Anh"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
<link rel="shortcut icon" type="image/png" href="/favicon.ico"/>

<!-- CSS -->
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600|Roboto:100,300,400,500,700|Volkhov:400i">
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />

<!--
/*
 * Airspace
 * Ported to Jekyll by Andrew Lee
 * https://github.com/luminousrubyist/airspace-jekyll
 * Designed and Developed by ThemeFisher
 * https://themefisher.com/
 *
 */
-->


  </head>
  <body>


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <!-- header Nav Start -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://www.tiepphan.com">
              <img src="/assets/logo.png" alt="Logo" class="img-logo">
              <span>Lập trình thật kỳ diệu</span>
            </a>
          </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li><a href="/">Home</a></li>
                <li><a href="/work/">Work</a></li>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/about/">About</a></li>
                <li><a href="/contact/">Contact</a></li>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
    </div>
  </div>
</header><!-- header close -->



    <div class="post">
  <!-- Wrapper Start -->
  <section>
    <div class="container">
      <div class="row">
        <div class="col-md-9">
          <div class="block">
            <h1>Angular HTTP Client Module - P2. Http Options và Demo Upload & Download Progress</h1>
            <div class="post-info-wrapper">
              <p class="italic">By <span class="bold">Tuan Anh</span> on <span class="bold">June 23, 2020</span></p>
            </div>
            <hr />
            <p><h1 class="no_toc" id="mở-đầu">Mở đầu</h1>

<p>Trong bài trước, mình đã giới thiệu sơ qua về <code class="language-plaintext highlighter-rouge">HttpClientModule</code> và những ứng dụng thiết yếu của nó.<br />
Học thì phải đi đôi với hành phải không nào? Hôm nay mình sẽ tiếp tục đi tiếp với Http Options và Demo 1 tính năng đó là <code class="language-plaintext highlighter-rouge">UPLOAD AND DOWNLOAD FILE WITH PROGRESS</code> nhé.<br />
Các bạn vừa đọc vừa mở IDE lên code cùng mình nhé.:)</p>

<p>Nào! bắt đầu thôi</p>

<ul class="tp__toc" id="markdown-toc">
  <li><a href="#post-intro" id="markdown-toc-post-intro">1. Http Options</a>    <ul>
      <li><a href="#11-headers" id="markdown-toc-11-headers">1.1 Headers</a></li>
      <li><a href="#12-observe" id="markdown-toc-12-observe">1.2 Observe</a>        <ul>
          <li><a href="#121-observe-body" id="markdown-toc-121-observe-body">1.2.1 Observe ‘body’</a></li>
          <li><a href="#122-observe-response" id="markdown-toc-122-observe-response">1.2.2 Observe ‘response’</a></li>
          <li><a href="#123-observe-events" id="markdown-toc-123-observe-events">1.2.3 Observe ‘events’</a></li>
        </ul>
      </li>
      <li><a href="#13-params" id="markdown-toc-13-params">1.3 Params</a>        <ul>
          <li><a href="#131-sử-dụng-fromstring-option" id="markdown-toc-131-sử-dụng-fromstring-option">1.3.1 Sử dụng fromString option</a></li>
          <li><a href="#132-sử-dụng-fromobject-option" id="markdown-toc-132-sử-dụng-fromobject-option">1.3.2 Sử dụng fromObject option</a></li>
          <li><a href="#133-sử-dụng-set-method-option" id="markdown-toc-133-sử-dụng-set-method-option">1.3.3 Sử dụng set method option</a></li>
        </ul>
      </li>
      <li><a href="#14-reportprogress" id="markdown-toc-14-reportprogress">1.4 reportProgress</a></li>
      <li><a href="#15-responsetype" id="markdown-toc-15-responsetype">1.5 responseType</a></li>
      <li><a href="#16-withcredentials" id="markdown-toc-16-withcredentials">1.6 withCredentials</a></li>
    </ul>
  </li>
  <li><a href="#2-demo-cùng-author" id="markdown-toc-2-demo-cùng-author">2. Demo cùng Author</a>    <ul>
      <li><a href="#21-upload-with-progress" id="markdown-toc-21-upload-with-progress">2.1 Upload with Progress</a></li>
      <li><a href="#22-download-with-progress" id="markdown-toc-22-download-with-progress">2.2 Download with Progress</a></li>
    </ul>
  </li>
</ul>

<h2 id="post-intro">1. Http Options</h2>
<p>Trong bài trước, mình có viết mẫu một <code class="language-plaintext highlighter-rouge">Post Service</code> để handle những việc nhận - gửi request liên quan tới <code class="language-plaintext highlighter-rouge">Post</code></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
  <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">PostService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">httpClient</span><span class="p">:</span> <span class="nx">HttpClient</span>
  <span class="p">)</span> <span class="p">{}</span>

  <span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">createPost</span><span class="p">(</span><span class="nx">post</span><span class="p">:</span> <span class="nx">PostEntityModel</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span><span class="p">(</span>
      <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
      <span class="nx">post</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">updatePost</span><span class="p">(</span>
    <span class="nx">postId</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="nx">post</span><span class="p">:</span> <span class="nx">PostEntityModel</span>
  <span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="nx">put</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span><span class="p">(</span>
      <span class="s2">`https://jsonplaceholder.typicode.com/posts/</span><span class="p">${</span><span class="nx">postId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="nx">post</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">updateOptionPost</span><span class="p">(</span>
    <span class="nx">postId</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="nx">post</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span>
  <span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="nx">patch</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span><span class="p">(</span>
      <span class="s2">`https://jsonplaceholder.typicode.com/posts/</span><span class="p">${</span><span class="nx">postId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
      <span class="nx">post</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">deletePost</span><span class="p">(</span><span class="nx">postId</span><span class="p">:</span> <span class="kr">number</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span>
      <span class="s2">`https://jsonplaceholder.typicode.com/posts/</span><span class="p">${</span><span class="nx">postId</span><span class="p">}</span><span class="s2">`</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Trong các method như get, post, put, có params là các option khi thực hiện 1 request http. Nó có dạng như sau:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">options</span><span class="p">:</span> <span class="p">{</span>
  <span class="nl">headers</span><span class="p">?:</span> <span class="nx">HttpHeaders</span> <span class="o">|</span> <span class="p">{[</span><span class="na">header</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">string</span><span class="p">[]},</span>
  <span class="nx">observe</span><span class="p">?:</span> <span class="dl">'</span><span class="s1">body</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">events</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">response</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">params</span><span class="p">?:</span> <span class="nx">HttpParams</span><span class="o">|</span><span class="p">{[</span><span class="na">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">string</span><span class="p">[]},</span>
  <span class="nx">reportProgress</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">,</span>
  <span class="nx">responseType</span><span class="p">?:</span> <span class="dl">'</span><span class="s1">arraybuffer</span><span class="dl">'</span><span class="o">|</span><span class="dl">'</span><span class="s1">blob</span><span class="dl">'</span><span class="o">|</span><span class="dl">'</span><span class="s1">json</span><span class="dl">'</span><span class="o">|</span><span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">withCredentials</span><span class="p">?:</span> <span class="nx">boolean</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Chúng ta cùng tìm hiểu và sử dụng các option này nhé.</p>

<h3 id="11-headers">1.1 Headers</h3>
<p><code class="language-plaintext highlighter-rouge">headers</code> trong <code class="language-plaintext highlighter-rouge">http options</code> là header configuration cho 1 <code class="language-plaintext highlighter-rouge">Http Request</code>.  Nó có thể là 1 <code class="language-plaintext highlighter-rouge">HttpHeaders</code> hoặc 1 object có <code class="language-plaintext highlighter-rouge">key</code> là <code class="language-plaintext highlighter-rouge">string</code> và giá trị là 1 <code class="language-plaintext highlighter-rouge">string</code> hoặc 1 <code class="language-plaintext highlighter-rouge">mảng string</code>.<br />
ví dụ hàm <code class="language-plaintext highlighter-rouge">GET</code>:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="na">angularVN</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Angular Việt Nam</span><span class="dl">'</span> <span class="p">}}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Hoặc sử dụng <code class="language-plaintext highlighter-rouge">HttpHeaders</code>:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">headers</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HttpHeaders</span><span class="p">({</span> <span class="na">angularVN</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Angular Viet Nam</span><span class="dl">'</span> <span class="p">})}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Kết quả:<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592901983/HTTP%20CLIENT%20MODULE/request-header-when-reassign-header-instance_fb5qq7.png" alt="Header are shown" /></p>

<p>Các bạn nên nhớ. Instance của một <code class="language-plaintext highlighter-rouge">HttpHeaders</code> là immutable nhé. Nghĩa là mỗi lần modify là trả về 1 <code class="language-plaintext highlighter-rouge">cloned instance</code> kèm thèm giá trị vừa modify nhé.<br />
Ví dụ:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">headers</span><span class="p">:</span> <span class="nx">HttpHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpHeaders</span><span class="p">();</span>
  <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">angularVN</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Angular Viet Nam</span><span class="dl">'</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">headers</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Kết quả:
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592901768/HTTP%20CLIENT%20MODULE/request-header-is-not-append-key_dhydwg.png" alt="Not working" /></p>

<p>Ở đây <code class="language-plaintext highlighter-rouge">Request Header</code> không có key <code class="language-plaintext highlighter-rouge">angularVN</code>. Như đã nói ở trên. <code class="language-plaintext highlighter-rouge">mỗi lần modify là trả về 1 cloned instance kèm thèm giá trị vừa modify</code>. Giải quyết bằng cách:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="na">headers</span><span class="p">:</span> <span class="nx">HttpHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpHeaders</span><span class="p">();</span>
  <span class="nx">headers</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">angularVN</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Angular Viet Nam</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// --&gt; gán lại cho biến headers</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="nx">headers</span><span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Và kết quả là:
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592901983/HTTP%20CLIENT%20MODULE/request-header-when-reassign-header-instance_fb5qq7.png" alt="Header are shown" /></p>

<h3 id="12-observe">1.2 Observe</h3>
<p><code class="language-plaintext highlighter-rouge">observe</code> là một giá trị kiểu string thuộc enum <code class="language-plaintext highlighter-rouge">'body' | 'events' | 'response'</code>. Nó báo cho <code class="language-plaintext highlighter-rouge">HttpClient</code> biết mình muốn lấy response ở mức độ nào. Mặc định nếu không set trong options thì sẽ lấy observe là <code class="language-plaintext highlighter-rouge">'body'</code>.<br />
Chúng ta cùng điểm qua các <code class="language-plaintext highlighter-rouge">observe</code> value nhé.</p>
<h4 id="121-observe-body">1.2.1 Observe ‘body’</h4>
<p>Mặc định khi gửi 1 <code class="language-plaintext highlighter-rouge">Http Request</code> và nhận lại một response. Chúng ta sẽ nhận được data là body của <code class="language-plaintext highlighter-rouge">HttpResponse</code></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">observe</span><span class="p">:</span> <span class="dl">'</span><span class="s1">body</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="122-observe-response">1.2.2 Observe ‘response’</h4>
<p>Khi xử lý 1 <code class="language-plaintext highlighter-rouge">Http Request</code>, bạn có thể cần nhiều thông tin hơn về response như <code class="language-plaintext highlighter-rouge">status</code>, <code class="language-plaintext highlighter-rouge">statusText</code>, <code class="language-plaintext highlighter-rouge">headers</code>. Chúng ta sử dụng option <code class="language-plaintext highlighter-rouge">observe: 'response'</code> để hiển thị thêm thông tin của <code class="language-plaintext highlighter-rouge">Http Response</code> đó.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpResponse</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">observe</span><span class="p">:</span> <span class="dl">'</span><span class="s1">response</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Kết quả:<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592907735/HTTP%20CLIENT%20MODULE/observe-response-result_fgwn81.png" alt="Observe Response" /><br />
Chúng ta đã có thêm thông tin để xử lý tiếp rồi:)</p>

<h4 id="123-observe-events">1.2.3 Observe ‘events’</h4>
<p>Khi sử dụng <code class="language-plaintext highlighter-rouge">observe: 'events'</code>, chúng ta sẽ nhận được full event của 1 <code class="language-plaintext highlighter-rouge">Http Request</code>. Thực tế là nó sẽ đi từ bắt đầu gọi request tới lúc request response hoàn chỉnh
Hãy để ý nhé:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">createPost</span><span class="p">(</span><span class="nx">post</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="nx">post</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="nx">post</span><span class="p">,</span>
    <span class="p">{</span> <span class="na">observe</span><span class="p">:</span> <span class="dl">'</span><span class="s1">events</span><span class="dl">'</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592910602/HTTP%20CLIENT%20MODULE/http-obser-event-angular_zaspdq.png" alt="Observer events" />
Các bạn thấy đấy, từ <code class="language-plaintext highlighter-rouge">{type: 0}</code> cho đến <code class="language-plaintext highlighter-rouge">{type: 4}</code> là lúc request hoàn thành rồi. Lát nữa chúng ta sẽ demo có sự góp mặt của <code class="language-plaintext highlighter-rouge">Observe</code> này</p>

<h3 id="13-params">1.3 Params</h3>
<p>Khi bạn có 1 task gọi 1 API endpoint có query params. Bạn có bao giờ tự hỏi rẳng Angular có cung cấp sẵn để thực hiện công việc này hay không?<br />
Câu trả lời là <code class="language-plaintext highlighter-rouge">CÓ</code>, <code class="language-plaintext highlighter-rouge">params</code> trong <code class="language-plaintext highlighter-rouge">Http Options</code> giúp chúng ta thêm query params vào enpoint. Trong ví dụ sau đây, tôi cần thêm query params vào hàm <code class="language-plaintext highlighter-rouge">GET</code>:<br />
Có 3 cách để implement params options:</p>
<h4 id="131-sử-dụng-fromstring-option">1.3.1 Sử dụng fromString option</h4>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span><span class="na">params</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HttpParams</span><span class="p">({</span> <span class="na">fromString</span><span class="p">:</span> <span class="dl">'</span><span class="s1">title=AngularVietNam&amp;id=1</span><span class="dl">'</span> <span class="p">})}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h4 id="132-sử-dụng-fromobject-option">1.3.2 Sử dụng fromObject option</h4>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span><span class="na">params</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HttpParams</span><span class="p">({</span> <span class="na">fromObject</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">AngularVietNam</span><span class="dl">'</span><span class="p">,</span> <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">}})}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Lưu ý: cách này value của các key luôn luôn là <code class="language-plaintext highlighter-rouge">string</code> nhé.</p>
<h4 id="133-sử-dụng-set-method-option">1.3.3 Sử dụng set method option</h4>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span><span class="na">params</span><span class="p">:</span> <span class="k">new</span> <span class="nx">HttpParams</span><span class="p">().</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">title</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">AngularVietNam</span><span class="dl">'</span><span class="p">).</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">)}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Vì hàm <code class="language-plaintext highlighter-rouge">set</code> trả về chính instance của <code class="language-plaintext highlighter-rouge">HttpParams</code> đó nên chúng ta có thể chain.<br />
Cả 3 đều có chung kết quả:<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592929968/HTTP%20CLIENT%20MODULE/from-string-params-option_vtwjaj.png" alt="Query params" /></p>

<p><code class="language-plaintext highlighter-rouge">Http Params</code> có một số method khác các bạn tự tìm hiểu nhé. Vì phần này cũng dễ nên mình không đi sâu thêm</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">HttpParams</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">HttpParamsOptions</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">as</span> <span class="nx">HttpParamsOptions</span><span class="p">);</span>
  <span class="nx">has</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">boolean</span><span class="p">;</span>
  <span class="kd">get</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">getAll</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span><span class="p">[]</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nx">keys</span><span class="p">():</span> <span class="kr">string</span><span class="p">[];</span>
  <span class="nx">append</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">HttpParams</span><span class="p">;</span>
  <span class="kd">set</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">HttpParams</span><span class="p">;</span>
  <span class="k">delete</span><span class="p">(</span><span class="nx">param</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">?:</span> <span class="kr">string</span><span class="p">):</span> <span class="nx">HttpParams</span><span class="p">;</span>
  <span class="nx">toString</span><span class="p">():</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="14-reportprogress">1.4 reportProgress</h3>
<p><code class="language-plaintext highlighter-rouge">reportProgress</code> có giá trị <code class="language-plaintext highlighter-rouge">boolean</code> được dùng để thông báo progress event của chúng ta. Ví dụ chúng ta upload 1 hình ảnh thì nó sẽ report progress mình đã upload lên server. Các bạn có thể dùng dữ liệu này để show cho người dùng biết là đã upload được bao nhiêu %, ước tính thời gian xong .v.v</p>
<h3 id="15-responsetype">1.5 responseType</h3>
<p><code class="language-plaintext highlighter-rouge">responseType</code> option chỉ định <code class="language-plaintext highlighter-rouge">HttpRequest</code> đó sẽ trả về định dạng dữ liệu gì. Mặc định là <code class="language-plaintext highlighter-rouge">'json'</code>. Có các option khác là <code class="language-plaintext highlighter-rouge">'arraybuffer'</code> | <code class="language-plaintext highlighter-rouge">'blob'</code> | <code class="language-plaintext highlighter-rouge">'json'</code> | <code class="language-plaintext highlighter-rouge">'text'</code></p>
<h3 id="16-withcredentials">1.6 withCredentials</h3>
<p>Các <code class="language-plaintext highlighter-rouge">HttpRequest</code> trong Angular theo mặc định không truyền thông tin cookie với mỗi request. Điều này có nghĩa là nếu bạn muốn kèm theo thông tin Cookies, bạn phải sử dụng <code class="language-plaintext highlighter-rouge">withCredentials</code><br />
Sử dụng như sau:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">getListPosts</span><span class="p">():</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">httpClient</span><span class="p">.</span><span class="kd">get</span><span class="o">&lt;</span><span class="nx">PostEntityModel</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://jsonplaceholder.typicode.com/posts</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">{</span><span class="na">withCredentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Và kết quả là đã có thông tin Cookies rồi nhé:<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592932622/HTTP%20CLIENT%20MODULE/http-request-with-credentials_gaa2ig.png" alt="withCredentials" /><br />
<strong>Note:</strong> Hãy đảm bảo <code class="language-plaintext highlighter-rouge">Allow-Origin-With-Credentials</code> được set trong <code class="language-plaintext highlighter-rouge">CORS</code> trên server nhé. Nếu không sẽ bị chặn bởi <code class="language-plaintext highlighter-rouge">CORS</code></p>
<hr />

<p><strong>Ok vậy là chúng ta đi xong Http Request Options. Tiếp theo chúng ta sẽ làm một demo nhỏ nhỏ upload, download file kèm progress nhé. Let’s go !</strong></p>

<h2 id="2-demo-cùng-author">2. Demo cùng Author</h2>
<h3 id="21-upload-with-progress">2.1 Upload with Progress</h3>

<p>Chúng ta cùng đi qua một ứng dụng upload đơn giản nhé.</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Upload component html
<span class="nt">&lt;div</span> <span class="na">*ngIf=</span><span class="s">"arrayFileUpload.length &gt; 0 &amp;&amp; progress.percentage !== -1"</span> <span class="na">class=</span><span class="s">"progress"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"progress-bar"</span> <span class="na">role=</span><span class="s">"progressbar"</span> <span class="na">aria-valuemin=</span><span class="s">"0"</span> <span class="na">aria-valuemax=</span><span class="s">"100"</span>
    <span class="na">[ngStyle]=</span><span class="s">"{width:progress.percentage+'%'}"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"fileUpload"</span> <span class="na">class=</span><span class="s">"default-upload"</span> <span class="na">*ngIf=</span><span class="s">"arrayFileUpload.length &lt; 1; else localImage"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">"img-responsive default-image"</span> <span class="na">src=</span><span class="s">"//laichau.qlgd.vn/static/article/images/noimg.gif"</span> <span class="na">alt=</span><span class="s">"No image"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;ng-template</span> <span class="na">#localImage</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"image-col"</span> <span class="na">*ngFor=</span><span class="s">"let img of arrayFileUpload; let i = index"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"fileUpload"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">*ngIf=</span><span class="s">"img.url !== null"</span> <span class="na">[src]=</span><span class="s">"img.url"</span> <span class="na">alt=</span><span class="s">"Preview image"</span> <span class="na">class=</span><span class="s">"img-responsive"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/label&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/ng-template&gt;</span>
<span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"btn btn-default"</span> <span class="na">hidden</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">(change)=</span><span class="s">"selectFile($event)"</span> <span class="na">id=</span><span class="s">"fileUpload"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/label&gt;</span>
</code></pre></div></div>

<p>Style xíu cho thanh progress bar</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.progress-bar</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#129ad4</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.img-responsive</span><span class="o">,</span>
<span class="nc">.default-image</span> <span class="p">{</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">500px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Tạo service để upload:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">HttpClient</span><span class="p">,</span> <span class="nx">HttpEvent</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/common/http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">rxjs</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">BASE_URL</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">YOUR_URL_API</span><span class="dl">'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Injectable</span><span class="p">({</span>
  <span class="na">providedIn</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UploadService</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">http</span><span class="p">:</span> <span class="nx">HttpClient</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">postFile</span><span class="p">(</span><span class="nx">files</span><span class="p">:</span> <span class="nx">FileList</span><span class="p">):</span> <span class="nx">Observable</span><span class="o">&lt;</span><span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nb">Object</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="na">formData</span><span class="p">:</span> <span class="nx">FormData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">files</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">files</span><span class="dl">'</span><span class="p">,</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">files</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">BASE_URL</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">formData</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">observe</span><span class="p">:</span> <span class="dl">'</span><span class="s1">events</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">reportProgress</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Vì upload hình ảnh yêu cầu phải multipart/formdata nên phải khởi tạo instance của FormData nhé. Sau đó chúng ta append file và key vào. Ở đây server yêu cầu gửi file có key là <code class="language-plaintext highlighter-rouge">fileUpload</code></p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Upload component</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">ChangeDetectionStrategy</span><span class="p">,</span>
  <span class="nx">ChangeDetectorRef</span><span class="p">,</span>
  <span class="nx">Component</span><span class="p">,</span>
  <span class="nx">OnInit</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/core</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span>
  <span class="nx">HttpErrorResponse</span><span class="p">,</span>
  <span class="nx">HttpEvent</span><span class="p">,</span>
  <span class="nx">HttpEventType</span><span class="p">,</span>
  <span class="nx">HttpProgressEvent</span><span class="p">,</span>
  <span class="nx">HttpResponse</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@angular/common/http</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">UploadService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./upload.service</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">FileUpload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">url</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>
  <span class="nl">fileName</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">fileType</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
<span class="p">}</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="dl">'</span><span class="s1">app-upload</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./upload.component.html</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">styleUrls</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./upload.component.css</span><span class="dl">'</span><span class="p">],</span>
  <span class="na">changeDetection</span><span class="p">:</span> <span class="nx">ChangeDetectionStrategy</span><span class="p">.</span><span class="nx">OnPush</span><span class="p">,</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">UploadComponent</span> <span class="k">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="nl">progress</span><span class="p">:</span> <span class="p">{</span> <span class="na">percentage</span><span class="p">:</span> <span class="kr">number</span> <span class="p">}</span> <span class="o">=</span> <span class="p">{</span> <span class="na">percentage</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">};</span>
  <span class="nl">arrayFileUpload</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">FileUpload</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="nx">uploadService</span><span class="p">:</span> <span class="nx">UploadService</span><span class="p">,</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">cdr</span><span class="p">:</span> <span class="nx">ChangeDetectorRef</span><span class="p">,</span>
  <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

  <span class="nx">ngOnInit</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">getFileList</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">Event</span><span class="p">):</span> <span class="nx">FileList</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">target</span><span class="p">:</span> <span class="nx">HTMLInputElement</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span> <span class="k">as</span> <span class="nx">HTMLInputElement</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">selectFile</span><span class="p">(</span><span class="nx">event</span><span class="p">:</span> <span class="nx">Event</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">percentage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">const</span> <span class="na">selectedFiles</span><span class="p">:</span> <span class="nx">FileList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFileList</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">selectedFiles</span> <span class="o">&amp;&amp;</span> <span class="nx">selectedFiles</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">uploadLocal</span><span class="p">(</span><span class="nx">selectedFiles</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">uploadService</span><span class="p">.</span><span class="nx">postFile</span><span class="p">(</span><span class="nx">selectedFiles</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">({</span>
        <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nx">HttpProgressEvent</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="kd">type</span> <span class="o">===</span> <span class="nx">HttpEventType</span><span class="p">.</span><span class="nx">UploadProgress</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">percentage</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">data</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span> <span class="o">??</span> <span class="mi">1</span><span class="p">));</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cdr</span><span class="p">.</span><span class="nx">markForCheck</span><span class="p">();</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="k">instanceof</span> <span class="nx">HttpResponse</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Upload done</span><span class="dl">"</span><span class="p">)</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="na">error</span><span class="p">:</span> <span class="p">(</span><span class="na">error</span><span class="p">:</span> <span class="nx">HttpErrorResponse</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="nx">alert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="nx">uploadLocal</span><span class="p">(</span><span class="nx">selectedFiles</span><span class="p">:</span> <span class="nx">FileList</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">selectedFiles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="na">reader</span><span class="p">:</span> <span class="nx">FileReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
      <span class="kd">const</span> <span class="na">file</span><span class="p">:</span> <span class="nx">File</span> <span class="o">=</span> <span class="nx">selectedFiles</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">arrayFileUpload</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">fileName</span><span class="p">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="na">fileType</span><span class="p">:</span> <span class="nx">file</span><span class="p">.</span><span class="kd">type</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="p">};</span>
      <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">selectedFiles</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">(</span><span class="na">event</span><span class="p">:</span> <span class="nx">ProgressEvent</span><span class="o">&lt;</span><span class="nx">FileReader</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">arrayFileUpload</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">event</span><span class="p">?.</span><span class="nx">target</span><span class="p">?.</span><span class="nx">result</span> <span class="k">as</span> <span class="kr">string</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cdr</span><span class="p">.</span><span class="nx">markForCheck</span><span class="p">();</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Và chúng ta đã có kết quả. Yeah yeah:) Progress bar theo tiến trình upload nhé.<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592987729/HTTP%20CLIENT%20MODULE/ezgif.com-optimize_sldo9g.gif" alt="Upload progress" /></p>

<p>Vậy là đã xong phần upload. Tiếp theo mình chuyển qua download nhé:)</p>

<h3 id="22-download-with-progress">2.2 Download with Progress</h3>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span>
  <span class="na">class=</span><span class="s">"progress"</span>
  <span class="na">*ngIf=</span><span class="s">"progress &gt;= 0"</span>
  <span class="na">[ngStyle]=</span><span class="s">"{width: progress + '%'}"</span>
<span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;button</span> <span class="na">(click)=</span><span class="s">"downloadFile()"</span><span class="nt">&gt;</span>Download File<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.progress</span> <span class="p">{</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">3px</span><span class="p">;</span>
  <span class="nl">background</span><span class="p">:</span> <span class="m">#129AD4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">progress</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="nx">downloadFile</span><span class="p">():</span> <span class="k">void</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">downloadService</span><span class="p">.</span><span class="nx">downloadFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://cdn.filestackcontent.com/sZ9r8Bp5SCSZcY2TxPYn</span><span class="dl">'</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">({</span>
    <span class="na">next</span><span class="p">:</span> <span class="p">(</span><span class="na">data</span><span class="p">:</span> <span class="nx">HttpEvent</span><span class="o">&lt;</span><span class="nx">HttpProgressEvent</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="kd">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nx">HttpEventType</span><span class="p">.</span><span class="na">DownloadProgress</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">progress</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="nx">data</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="nx">HttpEventType</span><span class="p">.</span><span class="na">Response</span><span class="p">:</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">saveFile</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="dl">'</span><span class="s1">test.png</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">private</span> <span class="nx">saveFile</span><span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">Blob</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="nx">fileName</span><span class="p">;</span>
  <span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Kết quả:<br />
<img class="img-responsive" src="https://res.cloudinary.com/tuananh-asia/image/upload/v1592988548/HTTP%20CLIENT%20MODULE/download-progress_rqn7fb.gif" alt="Download Progress" />
Vậy là đã xong 2 demo rồi. Các bạn code theo mình đã chạy được chưa:)? Code chưa được thì code lại nhé :) không hiểu thì comment hỏi nha.<br />
Chung quy lại. <code class="language-plaintext highlighter-rouge">Angular HttpClient</code> cung cấp cho chúng ta những options bá đạo, giúp ích cho chúng ta rất nhiều trong công việc. Còn chờ gì nữa, hãy áp dụng những kiến thức này vào những case thực tế ngay khi có thể nhé.<br />
Bài viết hôm nay đến đây là kết thúc. Bài sau mình sẽ đi về <code class="language-plaintext highlighter-rouge">Interceptor</code>. <code class="language-plaintext highlighter-rouge">Interceptor</code> là một bài rất quan trọng, các bạn chú ý theo dõi nhé. Cảm ơn mọi người</p>

<p>Link tham khảo:</p>
<ol>
    <li><a href="https://angular.io/api/common/http/HttpClientModule">https://angular.io/api/common/http/HttpClientModule</a></li>
    <li><a href="https://angular.io/api/common/http/HttpParams">https://angular.io/api/common/http/HttpParams</a></li>
    <li><a href="https://angular.io/api/common/http/HttpHeaders">https://angular.io/api/common/http/HttpHeaders</a></li>
    <li><a href="https://angular.io/guide/http">https://angular.io/guide/http</a></li>
</ol>
</p>
          </div>
        </div>
        <div class="col-md-3">
          <h2>Facebook</h2>
          <div class="fb-page" data-href="https://www.facebook.com/LapTrinhThatKyDieu/" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="https://www.facebook.com/LapTrinhThatKyDieu/" class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/LapTrinhThatKyDieu/">Lập Trình Thật Kỳ Diệu</a></blockquote></div>
        </div>
      </div>
    </div>
  </section>
</div>
<p class="center-text" style="padding: 30px;">
  <a href="/blog">Back to blog</a>
</p>











    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="/about/">About</a></li>
            <li><a href="/contact/">Contact</a></li>
            <li><a href="/blog/">Blog</a></li>
            <li><a href="#">Terms</a></li>
          </ul>
        </div>
        <p>Copyright &copy; 2017 to present - tiepphan.com All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>

<!-- Js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-3.2.1.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>

<script src="/js/main.js"></script>

    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.9";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    </body>
</html>
